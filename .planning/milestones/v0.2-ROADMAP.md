# Milestone v0.2: Concerns Cleanup

**Status:** SHIPPED 2026-01-09
**Phases:** 5-8
**Total Plans:** 10

## Overview

A systematic cleanup of technical concerns identified during v0.1 refactoring. Addressed type safety issues, error handling gaps, and documentation needs while marking all CONCERNS.md items as resolved or deferred.

## Phases

### Phase 5: Type Safety

**Goal**: Fix type assertion (`as any`) issues in UI code
**Depends on**: v0.1 complete
**Plans**: 3 plans

Plans:
- [x] 05-01: Fix choice validation type in useActionController
- [x] 05-02: Replace DOM property storage with WeakMap in useZoomPreview
- [x] 05-03: Document introspector assertions (rule out as legitimate)

**Details:**
- Added hasId/hasValue type guards for safe property checking
- Used WeakMap pattern for DOM metadata storage (automatic GC benefit)
- Documented why runtime introspection requires `as any` (analogous to JSON.parse)

### Phase 6: Error Handling

**Goal**: Fix critical error handling gaps
**Depends on**: Phase 5
**Plans**: 3 plans

Plans:
- [x] 06-01: Add boardRefs error logging in selection-handler
- [x] 06-02: Add JSON.parse error handling in sqlite-storage (CRITICAL)
- [x] 06-03: Document acceptable silent errors (rule out)

**Details:**
- Added console.error logging before suppressing errors in boardRefs()
- Added try/catch around JSON.parse in SqliteStorageAdapter.load() to prevent server crashes
- Documented best-effort catch blocks (WebSocket attachment, Vite cache cleanup)

### Phase 7: Documentation

**Goal**: Fill documentation and API gaps
**Depends on**: Phase 6
**Plans**: 3 plans

Plans:
- [x] 07-01: Add MCTS Bot inline documentation
- [x] 07-02: Fix assertions.ts incomplete API (remove unused param)
- [x] 07-03: Add code-generator fallback warning

**Details:**
- Added 7 section dividers and improved JSDoc for MCTS Bot (821 lines)
- Removed unused withChoices parameter from assertActionAvailable
- Added console.warn and improved comments for fallback checker generation

### Phase 8: Concerns Cleanup

**Goal**: Update CONCERNS.md to mark all items resolved
**Depends on**: Phases 5-7
**Plans**: 1 plan

Plans:
- [x] 08-01: Update CONCERNS.md with resolution status for all items

**Details:**
- Marked all v0.1 and v0.2 concern items as RESOLVED or DEFERRED
- Deferred flow/engine.ts documentation (good test coverage makes it non-critical)

---

## Milestone Summary

**Key Decisions:**
- Used simple `in` operator type guards over branded types (clarity)
- Used WeakMap over symbols for DOM metadata (standard pattern)
- Documented intentional `as any` rather than trying to eliminate it (runtime introspection)
- Deferred flow/engine.ts docs â€” good test coverage (1,569-line test file) makes it non-critical

**Issues Resolved:**
- Type assertions eliminated in useActionController and useZoomPreview
- Silent error suppression now logged for debugging
- MCTS Bot now navigable with section dividers
- Incomplete API (withChoices) removed to prevent confusion
- Fallback checkers now warn developers

**Issues Deferred:**
- flow/engine.ts inline documentation (deferred until file modification needed)

**Technical Debt Incurred:**
- Pre-existing build errors in ai-trainer package (PlayerCollection index signature issues)
- 3 pre-existing test failures (server connection issues)

---

_For current project status, see .planning/ROADMAP.md_
