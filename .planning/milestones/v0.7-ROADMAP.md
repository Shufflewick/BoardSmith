# Milestone v0.7: Condition Tracing Refactor

**Shipped:** 2026-01-10
**Git Range:** d31bb64..8e748dd (26 commits)
**Stats:** 34 files changed, +1986 lines, -193 lines

## Summary

Redesigned action conditions to use object-based API where labels are structurally required, making detailed debugging automatic and mandatory. Implemented "pit of success" design - object-based conditions are the ONLY format, enforced by TypeScript at compile time.

## Accomplishments

### Phase 14: condition-api-refactor (2 plans)
- Added ConditionPredicate, ObjectCondition, and ConditionConfig types
- Action.condition() now requires object format with labeled predicates
- Implemented automatic condition tracing via evaluateConditionWithTrace()
- Removed ConditionTracer class entirely - auto-tracing replaces manual tracing
- Exported evaluateCondition helper for cross-package use

### Phase 15: game-migrations (2 plans)
- Migrated all 7 BoardSmith games to object-based condition format
- Migrated all 8 test file conditions to object format
- Split compound conditions into separate labeled predicates for granular debug output
- No function-style .condition() calls remain anywhere in codebase

### Phase 16: docs-migration-guide (1 plan)
- Removed backward compatibility layer entirely (pit of success design)
- TypeScript now catches function-format conditions at compile time
- Updated docs/actions-and-flow.md with object-only conditions
- Created docs/conditions.md API reference
- Created docs/condition-migration-guide.md for existing codebases

## Key Decisions

| Decision | Rationale | Outcome |
|----------|-----------|---------|
| Object-based conditions with labeled predicates | Labels are required, making tracing automatic | ✓ Good - debug output always explains failures |
| Remove backward compatibility entirely | Pit of success - right way is the only way | ✓ Good - TypeScript catches wrong usage at compile time |
| Remove ConditionTracer class | Auto-tracing via object conditions replaces manual tracing | ✓ Good - simpler API, less code to maintain |
| Split compound conditions in migrations | Granular debug output per predicate | ✓ Good - know exactly which check failed |

## Patterns Established

- **Pit of success API design**: Making the right way the only way, wrong way impossible at compile time
- **Object-based conditions**: `{ 'label': (ctx) => boolean }` format with automatic debug tracing
- **Labels describe WHY**: Labels explain intent ("has cards in hand") not implementation ("hand.count > 0")

## Phase Summaries

- [14-01-SUMMARY.md](../phases/14-condition-api-refactor/14-01-SUMMARY.md) - Condition API types
- [14-02-SUMMARY.md](../phases/14-condition-api-refactor/14-02-SUMMARY.md) - Auto-tracing and ConditionTracer removal
- [15-01-SUMMARY.md](../phases/15-game-migrations/15-01-SUMMARY.md) - Game condition migrations
- [15-02-SUMMARY.md](../phases/15-game-migrations/15-02-SUMMARY.md) - Test condition migrations
- [16-01-SUMMARY.md](../phases/16-docs-migration-guide/16-01-SUMMARY.md) - Documentation and migration guide

---
*Archived: 2026-01-10*
