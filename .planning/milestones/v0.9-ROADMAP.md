# v0.9 Parallel AI Training — SHIPPED 2026-01-13

## Goal

Add worker thread parallelization to `train-ai` CLI command to utilize multiple CPU cores, achieving near-linear speedup on modern machines.

## Accomplishments

### Phase 20: Simulator Exports
- Exported `simulateSingleGame` from ai-trainer (was private)
- Added serializable types for worker communication:
  - `SerializableGameStructure` (Map → Record)
  - `SerializableElementTypeInfo` (Set → Array)
  - `SerializableSimulationOptions`
- Added `serializeGameStructure()` and `deserializeGameStructure()` helpers

### Phase 21: Worker Infrastructure
- Created `simulation-worker.ts` - worker thread script for running simulations
- Created `parallel-simulator.ts` - coordinator with work-stealing pattern
- Worker crash recovery redistributes lost work to remaining workers
- Features regenerated in workers from serialized structure (no function serialization)

### Phase 22: CLI Integration
- Added `--parallel` flag to enable parallel simulation
- Added `--workers <count>` flag (default: CPU cores - 1)
- Parallel path bypasses AITrainer, calls `runParallelSimulations` directly
- Logs worker count at startup

### Phase 23: Verification
- Unit tests verify determinism (same seed = same aggregate results)
- Benchmark: Serial 171s → Parallel 21s (**8.3x speedup** with 11 workers)
- README documents parallel training usage and performance
- Bug fix: train-ai now respects `paths.rules` from `boardsmith.json`

## Key Decisions

| Decision | Rationale | Outcome |
|----------|-----------|---------|
| Work-stealing pattern | Handles varying game durations better than fixed batches | ✓ Good |
| Features regenerated in workers | Cleaner than serializing function code | ✓ Good |
| CLI bypasses AITrainer for parallel | CLI knows module path, AITrainer doesn't | ✓ Good |
| Determinism via aggregate stats | Work-stealing can reorder completion, but totals match | ✓ Good |
| Tests import from dist/ | Worker threads require actual .js files | ✓ Good |

## Stats

- **Phases:** 4
- **Plans:** 4
- **Commits:** 16 (feat: 5, test: 1, fix: 1, docs: 9)
- **Timeline:** 2026-01-13

## Files Created

- `packages/ai-trainer/src/simulation-worker.ts`
- `packages/ai-trainer/src/parallel-simulator.ts`
- `packages/ai-trainer/tests/parallel-simulator.test.ts`

## Files Modified

- `packages/ai-trainer/src/types.ts` (serializable types)
- `packages/ai-trainer/src/simulator.ts` (export simulateSingleGame)
- `packages/ai-trainer/src/index.ts` (exports)
- `packages/ai-trainer/README.md` (parallel training docs)
- `packages/cli/src/cli.ts` (CLI flags)
- `packages/cli/src/commands/train-ai.ts` (parallel integration, paths.rules fix)

---
*Milestone: v0.9 Parallel AI Training*
*Shipped: 2026-01-13*
