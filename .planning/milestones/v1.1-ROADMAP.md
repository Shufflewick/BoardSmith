# Milestone v1.1: MCTS Strategy Improvements

**Status:** ✅ SHIPPED 2026-01-16
**Phases:** 29-36 (+30.1 inserted)
**Total Plans:** 10

## Overview

Make MCTS AI play strategically better by adding lookahead, threat detection, and advanced search techniques. Each phase was tested against Hex AI - improvements were kept, regressions reverted.

## Phases

### Phase 29: playout-lookahead ✅
**Goal**: Enable simulation lookahead (playoutDepth > 0) so AI can discover forcing sequences
**Depends on**: Phase 28.1
**Research**: Unlikely (parameter change)
**Plans**: 1/1 complete

Plans:
- [x] 29-01: Change playoutDepth from 0 to 3-5 in difficulty presets

**Results:** P1 win rate improved from 40% to 57.5%, games 30% longer (more contested), response time improved.

### Phase 30: threat-response ✅
**Goal**: Force AI to consider defensive moves when opponent has immediate threats
**Depends on**: Phase 29
**Research**: Unlikely (internal MCTS enhancement)
**Plans**: 1/1 complete

Plans:
- [x] 30-01: Add threatResponseMoves hook, Hex blocking detection, session wiring

### Phase 30.1: improve-generate-ai (INSERTED) ✅
**Goal**: Improve `/generate-ai` slash command based on lessons from Hex AI debugging
**Depends on**: Phase 30
**Research**: Unlikely (leveraging existing implementation learnings)
**Plans**: 1/1 complete

Plans:
- [x] 30.1-01: Add threat response, playout policy, and human testing to /generate-ai

**Details:**
Key lessons from Hex AI that `/generate-ai` should incorporate:
1. **Threat response is critical** - Games need blocking/defensive move detection, not just offensive evaluation
2. **Playout policy matters** - Random playouts produce random-looking play; weighted playouts based on connectivity/position improve quality
3. **Move sampling can hide critical moves** - If threat response happens AFTER sampling, blocking moves may be filtered out
4. **Path-based analysis for connection games** - Dijkstra shortest-path provides concrete threat detection thresholds
5. **Test against human strategies** - AI vs AI benchmarks don't catch simple human exploits (straight lines in Hex)

### Phase 31: trajectory-objectives ✅
**Goal**: Add feature templates that detect momentum/trajectory, not just static state
**Depends on**: Phase 30
**Research**: Unlikely (feature template addition)
**Plans**: 1/1 complete

Plans:
- [x] 31-01: Add 6 trajectory/momentum feature templates (tempo, initiative, position quality)

### Phase 32: move-ordering ✅
**Goal**: Prioritize exploring moves near opponent's pieces/recent activity
**Depends on**: Phase 31
**Research**: Unlikely (move sorting heuristic)
**Plans**: 1/1 complete

Plans:
- [x] 32-01: Add moveOrdering hook to AIConfig, implement for Hex

### Phase 33: rave ✅
**Goal**: Implement RAVE (Rapid Action Value Estimation) to learn from all simulations
**Depends on**: Phase 32
**Research**: Unlikely (well-documented algorithm)
**Plans**: 1/1 complete

Plans:
- [x] 33-01: Add RAVE data structures, move tracking, UCT-RAVE selection

### Phase 34: gradient-objectives ✅
**Goal**: Change objectives from boolean to numeric for finer-grained evaluation
**Depends on**: Phase 33
**Research**: Unlikely (interface change)
**Plans**: 1/1 complete

Plans:
- [x] 34-01: Update Objective interface, MCTS evaluation, Hex objectives to [0,1] gradients

### Phase 35: dynamic-uct ✅
**Goal**: Adjust UCT exploration constant based on game phase
**Depends on**: Phase 34
**Research**: Likely (needs parameter tuning research)
**Plans**: 1/1 complete

Plans:
- [x] 35-01: Add configurable UCT constant with phase-based tuning for Hex

### Phase 36: proof-number-search ✅
**Goal**: Detect forced wins/losses that MCTS might miss using PN search
**Depends on**: Phase 35
**Research**: Completed (PN-MCTS algorithm from arXiv:2303.09449)
**Plans**: 2/2 complete

Plans:
- [x] 36-01: Add PN-MCTS core infrastructure (proof numbers, UCT-PN selection)
- [x] 36-02: Final move selection using proof status, benchmark validation

**Benchmark Results:**
- PN-MCTS as P2: +7.5% win rate improvement vs baseline
- Overhead: +1.7% move time (negligible)

---

## Milestone Summary

**Decimal Phases:**
- Phase 30.1: improve-generate-ai (inserted after Phase 30 for /generate-ai improvements)

**Key Decisions:**
- Playout depth 3 as default (balances quality vs speed)
- Threat response at root only (avoids distorting tree search)
- RAVE with equivalence parameter k=1000 (standard recommendation)
- UCT constant tuned by game phase (higher exploration early, more exploitation late)
- PN-MCTS proof threshold of 5 visits (ensures sufficient samples before trusting)

**Issues Resolved:**
- AI now blocks obvious straight-line strategies (was exploitable by humans)
- Disadvantaged player (P2 in Hex) significantly improved

**Issues Deferred:**
- None

**Technical Debt Incurred:**
- Some benchmark scripts in scripts/ directory (not production code)

---

*For current project status, see .planning/ROADMAP.md*
