# Roadmap: BoardSmith v2.0 Collapse the Monorepo

## Overview

Transform BoardSmith from a pnpm monorepo with multiple `@boardsmith/*` packages into a single `boardsmith` npm package with subpath exports. Extract all games to separate repositories. The result: a clean library that external consumers import via `boardsmith`, `boardsmith/ui`, `boardsmith/ai`, etc.

## Milestone Goal

Make board game development fast and correct by providing a single package that handles multiplayer, AI, and UI -- so designers focus on game rules, not package management.

## Phases

**Phase Numbering:**
- Integer phases (39, 40, 41...): Planned milestone work
- Decimal phases (39.1, 39.2): Urgent insertions (marked with INSERTED)

- [x] **Phase 39: Foundation** - Single package.json, npm tooling, basic structure -- completed 2026-01-18
- [ ] **Phase 40: Source Collapse** - Move all package sources to src/ folders
- [ ] **Phase 41: Test Colocation** - Move tests next to source files
- [ ] **Phase 42: Subpath Exports** - Configure all exports in package.json
- [ ] **Phase 43: Import Rewrite** - Update all internal imports to relative paths
- [ ] **Phase 44: Game Extraction** - Extract games and demos to separate repos
- [ ] **Phase 45: CLI Update** - Update CLI commands for new structure
- [ ] **Phase 46: Documentation** - Update docs and write migration guide

## Phase Details

### Phase 39: Foundation
**Goal**: Establish single-package structure with npm tooling
**Depends on**: v1.2 complete
**Requirements**: PKG-01, PKG-13, SRC-14
**Success Criteria** (what must be TRUE):
  1. Single root package.json exists with name "boardsmith"
  2. npm install works (no pnpm-lock.yaml or pnpm-workspace.yaml)
  3. package-lock.json exists and is valid
  4. Basic exports field configured (even if empty)
**Plans**: 1/1 complete
- [x] 39-01-PLAN.md -- Migrate from pnpm to npm, add exports field

### Phase 40: Source Collapse
**Goal**: Consolidate all package sources into src/ directory structure
**Depends on**: Phase 39
**Requirements**: SRC-01, SRC-02, SRC-03, SRC-04, SRC-05, SRC-06, SRC-07, SRC-08, SRC-09, SRC-10, SRC-11, SRC-12
**Success Criteria** (what must be TRUE):
  1. src/engine/ contains all @boardsmith/engine source
  2. src/ui/ contains all @boardsmith/ui source
  3. src/session/, src/cli/, src/testing/, src/eslint-plugin/, src/ai/, src/ai-trainer/, src/client/, src/server/, src/runtime/, src/worker/ all populated
  4. Old packages/ directory removed or empty
  5. TypeScript compilation succeeds (may have import errors)
**Plans**: TBD

### Phase 41: Test Colocation
**Goal**: Move all tests to be colocated with source files
**Depends on**: Phase 40
**Requirements**: SRC-13
**Success Criteria** (what must be TRUE):
  1. Every *.test.ts file sits next to its corresponding source file
  2. No separate __tests__ or tests/ directories within src/
  3. Vitest configuration finds all colocated tests
  4. All tests discovered (count matches pre-migration)
**Plans**: TBD

### Phase 42: Subpath Exports
**Goal**: Configure all package.json exports for subpath imports
**Depends on**: Phase 41
**Requirements**: PKG-02, PKG-03, PKG-04, PKG-05, PKG-06, PKG-07, PKG-08, PKG-09, PKG-10, PKG-11, PKG-12
**Success Criteria** (what must be TRUE):
  1. `import { Game } from 'boardsmith'` resolves to src/engine/
  2. `import { BoardView } from 'boardsmith/ui'` resolves to src/ui/
  3. All 11 subpath exports (ui, session, testing, eslint-plugin, ai, ai-trainer, client, server, runtime, worker) resolve correctly
  4. TypeScript understands exports (no red squiggles in IDE)
  5. External test project can import from all subpaths
**Plans**: TBD

### Phase 43: Import Rewrite
**Goal**: Replace all @boardsmith/* imports with relative paths
**Depends on**: Phase 42
**Requirements**: IMP-01, IMP-02, IMP-03
**Success Criteria** (what must be TRUE):
  1. Zero occurrences of `@boardsmith/` in any source file
  2. All internal imports use relative paths (../engine/, ./types, etc.)
  3. Cross-concern imports work (e.g., ui importing from engine)
  4. TypeScript compilation succeeds with zero errors
  5. All tests pass
**Plans**: TBD

### Phase 44: Game Extraction
**Goal**: Extract all games and demos to separate repositories
**Depends on**: Phase 43
**Requirements**: GAME-01, GAME-02, GAME-03, GAME-04, GAME-05, GAME-06, GAME-07, GAME-08, GAME-09, GAME-10, GAME-11
**Success Criteria** (what must be TRUE):
  1. Hex game runs standalone with `boardsmith` as npm dependency
  2. Go Fish, Checkers, Cribbage, Polyhedral Potions run standalone
  3. Demo ActionPanel, Animation, ComplexUiInteractions run standalone
  4. All extracted games use npm (package-lock.json, no pnpm)
  5. No games or demos remain in BoardSmith repo
  6. (Floss Bitties: extracted but not required to work)
**Plans**: TBD

### Phase 45: CLI Update
**Goal**: Update all CLI commands to work with new structure
**Depends on**: Phase 44
**Requirements**: CLI-01, CLI-02, CLI-03, CLI-04, CLI-05, CLI-06
**Success Criteria** (what must be TRUE):
  1. `boardsmith create my-game` scaffolds standalone npm project using boardsmith
  2. `boardsmith dev` runs dev server for extracted game
  3. `boardsmith build` produces production build
  4. `boardsmith test` runs tests
  5. `boardsmith pack` creates single tarball (not multiple packages)
  6. All CLI help text shows new import paths
**Plans**: TBD

### Phase 46: Documentation
**Goal**: Update all documentation for new structure
**Depends on**: Phase 45
**Requirements**: DOC-01, DOC-02, DOC-03, DOC-04
**Success Criteria** (what must be TRUE):
  1. Getting started guide uses `import { Game } from 'boardsmith'` (not @boardsmith/engine)
  2. API reference shows subpath exports
  3. No documentation mentions @boardsmith/* packages
  4. Migration guide exists for external team with step-by-step instructions
**Plans**: TBD

## Progress

| Phase | Plans Complete | Status | Completed |
|-------|----------------|--------|-----------|
| 39. Foundation | 1/1 | Complete | 2026-01-18 |
| 40. Source Collapse | 0/TBD | Not started | - |
| 41. Test Colocation | 0/TBD | Not started | - |
| 42. Subpath Exports | 0/TBD | Not started | - |
| 43. Import Rewrite | 0/TBD | Not started | - |
| 44. Game Extraction | 0/TBD | Not started | - |
| 45. CLI Update | 0/TBD | Not started | - |
| 46. Documentation | 0/TBD | Not started | - |
