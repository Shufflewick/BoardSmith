# Milestone v2.5: Player Colors Refactor

**Status:** âœ… SHIPPED 2026-01-25
**Phases:** 64-68
**Total Plans:** 5

## Overview

Refactor player colors from game-managed to engine-managed. Players get a `color` property, games define available colors via configuration, and UI components adapt automatically. This enables consistent color handling across all games and eliminates the fragmented `DEFAULT_PLAYER_COLORS` pattern.

## Phases

### Phase 64: Engine Layer

**Goal**: Players have engine-managed color properties with game-configurable palettes
**Depends on**: Nothing (first phase)
**Plans**: 1 plan

Plans:
- [x] 64-01: Add DEFAULT_COLOR_PALETTE, extend GameOptions, color validation and auto-assignment

**Details:**
- Added DEFAULT_COLOR_PALETTE constant with 8 distinct colors
- Extended GameOptions with colors and colorSelectionEnabled properties
- Implemented color validation in Game constructor (fail-fast if too few colors)
- Auto-assign colors to players during creation based on seat index
- Store color configuration in game.settings for session layer access

### Phase 65: Session Layer

**Goal**: Players can change colors during lobby, with proper conflict handling
**Depends on**: Phase 64
**Plans**: 1 plan

Plans:
- [x] 65-01: Add color conflict validation to updatePlayerOptions and updateSlotPlayerOptions

**Details:**
- Added ErrorCode.COLOR_ALREADY_TAKEN for programmatic error handling
- Added #validateColorChange private method to LobbyManager
- Integrated validation into updatePlayerOptions (player changes own color)
- Integrated validation into updateSlotPlayerOptions (host assigns colors)

### Phase 66: UI Layer

**Goal**: Lobby and PlayerStats display player colors with selection UI
**Depends on**: Phase 65
**Plans**: 1 plan

Plans:
- [x] 66-01: Extend LobbyInfo with color config, add conditional color UI to WaitingRoom and PlayersPanel

**Details:**
- Extended LobbyInfo and StoredGameState interfaces with colorSelectionEnabled and colors fields
- WaitingRoom auto-injects color picker option when colorSelectionEnabled is true
- PlayersPanel conditionally shows player color indicator based on colorSelectionEnabled prop
- GameShell tracks colorSelectionEnabled state and passes it through to PlayersPanel

### Phase 67: Cleanup

**Goal**: Old color API removed, documentation updated
**Depends on**: Phase 66
**Plans**: 1 plan

Plans:
- [x] 67-01: Deprecate DEFAULT_PLAYER_COLORS with migration guidance, update docs to show player.color API

**Details:**
- Added @deprecated JSDoc to DEFAULT_PLAYER_COLORS with clear migration guidance
- Updated all documentation to show player.color as the primary color API
- Added Player Colors section to core-concepts.md explaining auto-assigned colors
- Added migration example in ui-components.md for upgrading from old API

### Phase 68: Game Updates

**Goal**: Hex and Checkers migrated to use player.color (MERC game N/A - does not exist; other games N/A - don't use player colors)
**Depends on**: Phase 67
**Plans**: 1 plan

Plans:
- [x] 68-01: Migrate Hex and Checkers to player.color API, remove deprecated imports and fallbacks

**Details:**
- Removed all DEFAULT_PLAYER_COLORS imports from Hex game (4 files)
- Removed all color constant definitions and applyPlayerColors() methods from Checkers game
- Added colors array to Checkers boardsmith.json preserving red/dark gray theme
- Removed shadowing color property from CheckersPlayer class

---

## Milestone Summary

**Key Decisions:**
- Seat-based color conflict detection (works for AI slots which have no playerId)
- Auto-inject color picker via computed (games don't define color options)
- JSDoc @deprecated vs runtime warning (editor-visible with zero runtime cost)
- Custom game colors in boardsmith.json (Checkers preserves red/dark theme via config)
- Engine guarantees player.color (remove fallback chains, null-safety only)

**Issues Resolved:**
- DEFAULT_PLAYER_COLORS index mismatch with seat (1-indexed vs 0-indexed)
- Games had to manually manage player colors
- No standard way to configure game color palettes
- Color conflicts possible in lobby (multiple players same color)

**Issues Deferred:**
- None

**Technical Debt Incurred:**
- None - clean implementation

---

*For current project status, see .planning/ROADMAP.md (created for next milestone)*
*Archived: 2026-01-25 as part of v2.5 milestone completion*
