# Milestone v2.7: Dead Code & Code Smell Cleanup

**Status:** ✅ SHIPPED 2026-02-02
**Phases:** 69-74
**Total Plans:** 6

## Overview

v2.7 cleans up all identified dead code, type duplication, and code smells discovered during v2.6. The work flows from quick config fixes through systematic type consolidation, deprecated API removal (migrate callers first), code duplication extraction, and code smell refactors, culminating in BREAKING.md documentation.

## Phases

### Phase 69: Config & Vestigial Cleanup

**Goal**: Build tooling configuration is accurate and vestigial files are removed
**Depends on**: Nothing (first phase)
**Plans**: 1 plan

Plans:
- [x] 69-01-PLAN.md — Fix stale config paths and remove utils.ts re-export file

**Details:**
- Removed stale paths from vitest.config.ts (packages/, cli/, game-specific aliases)
- Fixed ESLint configuration to lint src/**/*.ts instead of packages/**/*.ts
- Removed vestigial src/ai/utils.ts single-export proxy file

### Phase 70: Type Consolidation

**Goal**: Lobby-related types have a single canonical source in types/protocol.ts
**Depends on**: Phase 69
**Plans**: 1 plan

Plans:
- [x] 70-01-PLAN.md — Consolidate lobby types to types/protocol.ts with re-exports

**Details:**
- Consolidated LobbyState, SlotStatus, LobbySlot, LobbyInfo to types/protocol.ts
- session/types.ts and client/types.ts now re-export from canonical source
- Eliminated type drift risk from 4 duplicate definitions

### Phase 71: Deprecated API Removal

**Goal**: Deprecated flying APIs are removed after all internal callers migrate to new APIs
**Depends on**: Phase 70
**Plans**: 1 plan

Plans:
- [x] 71-01-PLAN.md — Migrate internal callers and remove deprecated flying APIs

**Details:**
- Migrated usePlayerStatAnimation.ts, AutoGameBoard.vue, useActionAnimations.ts to fly()/flyMultiple()/FlyConfig
- Removed flyCard(), flyCards(), and FlyCardOptions from useFlyingElements.ts
- Updated documentation with new API

### Phase 72: Code Duplication Fixes

**Goal**: Repeated code patterns are extracted into shared helpers
**Depends on**: Phase 71
**Plans**: 1 plan

Plans:
- [x] 72-01-PLAN.md — Extract shared helpers for FlowEngine completion and useActionController auto-fill

**Details:**
- Extracted handleActionStepCompletion() and completeActionStep() helpers in FlowEngine
- Extracted tryAutoFillSelection() and fetchAndAutoFill() helpers in useActionController
- Reduced ~130 lines of duplicated code

### Phase 73: Code Smell Refactors

**Goal**: Code smells are fixed with proper patterns
**Depends on**: Phase 72
**Plans**: 1 plan

Plans:
- [x] 73-01-PLAN.md — Replace module-level flag with fetchedSelections Set and fix redundant type

**Details:**
- Replaced suppressNextWatcherFetch module-level flag with scoped fetchedSelections Set in ActionStateSnapshot
- Fixed redundant unknown | undefined return type in injectBoardInteraction()

### Phase 74: Documentation

**Goal**: Breaking changes are documented for external users
**Depends on**: Phase 73
**Plans**: 1 plan

Plans:
- [x] 74-01-PLAN.md — Create BREAKING.md with v2.7 breaking changes documentation

**Details:**
- Created BREAKING.md with v2.7 migration guide
- Documented flyCard/flyCards/FlyCardOptions removal with migration to fly/flyMultiple/FlyConfig
- Documented src/ai/utils.ts removal with canonical import path
- Documented lobby type consolidation to types/protocol.ts

---

## Milestone Summary

**Key Decisions:**
- Direct imports to canonical locations preferred over re-export proxy files
- Lobby types canonical source: types/protocol.ts with re-exports for backwards compatibility
- Removed deprecated APIs without deprecation period since internal-only usage
- FlowEngine helper returns boolean to signal caller behavior for followUp
- useActionController helpers split into sync (tryAutoFillSelection) and async (fetchAndAutoFill)
- fetchedSelections Set added to ActionStateSnapshot for per-action scoped coordination
- BREAKING.md in project root as standard location for breaking change documentation

**Issues Resolved:**
- Fixed stale monorepo paths in build configuration
- Eliminated type drift risk from 4 duplicate lobby type definitions
- Removed deprecated flying element APIs after clean migration
- Extracted shared logic eliminating ~130 lines of duplication
- Replaced fragile module-level coordination flag with proper scoped state

**Issues Deferred:**
None

**Technical Debt Incurred:**
None - all cleanup work complete.

---

*For current project status, see .planning/ROADMAP.md*
