---
milestone: v2.8
audited: 2026-02-06T20:00:00Z
status: passed
scores:
  requirements: 20/20
  phases: 5/5
  integration: 7/7
  flows: 6/6
gaps:
  requirements: []
  integration: []
  flows: []
tech_debt: []
---

# v2.8 Milestone Audit: Disabled Selections

**Audited:** 2026-02-06 (re-audit after Phase 79 gap closure)
**Status:** passed
**Milestone Goal:** Add a `disabled` state to element and choice selections so items remain visible but unselectable, with a mandatory reason string.

## Phase Verification Summary

| Phase | Status | Score | Verified |
|-------|--------|-------|----------|
| 75. Engine Core | Passed | 4/4 | 2026-02-06 |
| 76. Session Wire | Passed | 4/4 | 2026-02-06 |
| 77. UI Integration | Passed | 5/5 | 2026-02-06 |
| 78. Documentation | Passed | 4/4 | 2026-02-06 |
| 79. Fix element-type disabled | Passed | 4/4 | 2026-02-06 |

All 5 phases passed verification. Phase 79 closed the integration gap found in the first audit.

## Requirements Coverage

| Requirement | Phase | Status |
|-------------|-------|--------|
| ENG-01: `chooseElement` accepts `disabled` option | 75 | SATISFIED |
| ENG-02: `fromElements` accepts `disabled` option | 75 | SATISFIED |
| ENG-03: `chooseFrom` accepts `disabled` option | 75 | SATISFIED |
| ENG-04: `getChoices()` returns `AnnotatedChoice<T>[]` | 75 | SATISFIED |
| ENG-05: `hasValidSelectionPath()` only counts enabled items | 75 | SATISFIED |
| ENG-06: `validateSelection()` rejects disabled with reason | 75 | SATISFIED |
| SES-01: `ValidElement` gains `disabled?: string` | 76 | SATISFIED |
| SES-02: `ChoiceWithRefs` gains `disabled?: string` | 76 | SATISFIED |
| SES-03: PickHandler threads disabled from engine to wire | 76 | SATISFIED |
| UI-01: ActionPanel disabled element buttons with tooltip | 77 | SATISFIED |
| UI-02: ActionPanel disabled choice buttons with tooltip | 77 | SATISFIED |
| UI-03: `isDisabledElement()` method | 77 | SATISFIED |
| UI-04: `triggerElementSelect` ignores disabled clicks | 77 | SATISFIED |
| UI-05: `bs-element-disabled` CSS class | 77 | SATISFIED |
| UI-06: `validElements` carries `disabled` for custom UIs | 77 | SATISFIED |
| UI-07: `getChoices()`/`getCurrentChoices()` carry `disabled` | 77, 79 | SATISFIED |
| UI-08: `fill()` rejects disabled with reason | 77, 79 | SATISFIED |
| UI-09: Auto-fill skips disabled items | 77, 79 | SATISFIED |
| DOC-01: BREAKING.md v2.8 section | 78 | SATISFIED |
| DOC-02: Migration guide updated for v2.8 | 78 | SATISFIED |

**20/20 requirements satisfied.**

## Cross-Phase Integration

All 7 integration points connected and verified:

1. **Engine -> Session wire types** -- AnnotatedChoice disabled maps to ValidElement.disabled and ChoiceWithRefs.disabled via PickHandler
2. **Session -> UI types** -- Wire types carry disabled through to all UI-layer interfaces
3. **UI types -> ActionPanel rendering** -- All 6 button templates render disabled with tooltip
4. **ActionPanel -> Board interaction -> AutoElement** -- Disabled elements get CSS class, click guard works
5. **Engine validation** -- Server-side validateSelection rejects disabled items
6. **AI bot** -- Filters disabled choices, never selects them
7. **getChoices() threads disabled for element-type picks** -- Phase 79 added `...(el.disabled && { disabled: el.disabled })` spread to all 3 element-to-choice map calls

### Previous Gap (Resolved by Phase 79)

The first audit found that `getChoices()` in `useActionController.ts` dropped the `disabled` field when converting `ValidElement[]` to choice-like arrays. Phase 79 fixed all 3 affected code paths (lines 289, 314, 325) and added 4 tests covering getChoices, fill rejection, auto-fill filtering, and elementsByDependentValue.

## E2E Flow Verification

| Flow | Status |
|------|--------|
| Disabled choice button -> can't click -> tooltip shows reason | COMPLETE |
| Disabled board element -> can't click -> visual muting + tooltip | COMPLETE |
| Custom UI reads disabled from `validElements` for elements | COMPLETE |
| Custom UI reads disabled from `getChoices()` for choices and elements | COMPLETE |
| Auto-fill skips disabled choices (all 3 code paths) | COMPLETE |
| Auto-fill skips disabled elements via `getChoices()` | COMPLETE |

All 6 E2E flows verified end-to-end with no breaks.

### Defense in Depth

Disabled is enforced at 3 independent layers:
- **Engine** (`validateSelection`): Server-side rejection with reason string
- **UI validation** (`fill()` -> `validateSelection`): Client-side rejection with reason string
- **Board interaction** (`triggerElementSelect` guard): Silent click ignore for disabled elements

## Test Coverage

| Layer | Test File | Disabled Tests | Status |
|-------|-----------|----------------|--------|
| Engine | `action.test.ts` | 10 tests | Pass |
| Session | `pick-handler.test.ts` | 6 tests | Pass |
| UI (choice-type) | `useActionController.test.ts` | 7 tests | Pass |
| UI (element-type) | `useActionController.test.ts` | 4 tests | Pass |

**27 disabled-specific tests** across engine, session, and UI layers.

## Human Verification Pending

From Phase 77, 3 items require browser testing:
1. Visual disabled rendering in ActionPanel (greyed out buttons with tooltips)
2. Board element disabled visual (opacity 0.5, grayscale, not-allowed cursor)
3. End-to-end auto-fill with disabled items

## Anti-Patterns

None found across all 5 phases. No TODOs, stubs, placeholders, or empty handlers.

---

*First audit: 2026-02-06 (gaps_found -- element-type getChoices dropped disabled)*
*Re-audit: 2026-02-06 (passed -- Phase 79 closed all gaps)*
*Auditor: Claude (gsd milestone audit)*
