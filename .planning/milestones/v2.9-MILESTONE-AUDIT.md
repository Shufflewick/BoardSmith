---
milestone: v2.9
audited: 2026-02-07T20:00:00Z
status: tech_debt
scores:
  requirements: 21/21
  phases: 5/5
  integration: 7/7
  flows: 7/7
gaps: []
tech_debt:
  - phase: 83-ui-composables
    items:
      - "`GameShell.vue` line 169: `(state.value?.state as any)?.animationEvents` -- type cast needed because client PlayerState type lacks animationEvents field"
      - "`GameShell.vue` line 219: `(state.value?.state as any)?.currentView` -- same pattern, server field not on client type"
  - phase: 84-clean-break-and-migration
    items:
      - "BREAKING.md line 49/123 states group option was removed, but `animate()` actually accepts `{ group?: string }` -- documentation inaccuracy"
---

# v2.9 Theatre View - Milestone Audit

**Audited:** 2026-02-07
**Status:** All requirements met. No critical blockers. Minor tech debt.

## Requirements Coverage

| Requirement | Phase | Status |
|-------------|-------|--------|
| ENG-01: `game.animate(type, data, callback)` scoped callback API | 80 | SATISFIED |
| ENG-02: Mutation capture tracks element tree changes | 80 | SATISFIED |
| ENG-03: Mutation capture tracks custom game property changes | 80 | SATISFIED |
| ENG-04: Theatre state maintained at engine level | 81 | SATISFIED |
| ENG-05: Per-event acknowledgment advances theatre state | 81 | SATISFIED |
| ENG-06: Theatre state serializes and restores | 81 | SATISFIED |
| ENG-07: `emitAnimationEvent()` removed | 84 | SATISFIED |
| ENG-08: Monotonically increasing event IDs | 80 | SATISFIED |
| SES-01: `buildPlayerState()` produces theatre view | 82 | SATISFIED |
| SES-02: `PlayerGameState` carries current view opt-in | 82 | SATISFIED |
| SES-03: `acknowledgeAnimations()` advances and rebroadcasts | 82 | SATISFIED |
| SES-04: All clients receive theatre view | 82 | SATISFIED |
| UI-01: `useAnimationEvents` updated for animate() flow | 83 | SATISFIED |
| UI-02: Components render theatre view by default | 83 | SATISFIED |
| UI-03: Explicit opt-in for current view | 83 | SATISFIED |
| UI-04: ActionPanel renders from theatre state mid-animation | 83 | SATISFIED |
| UI-05: Skip acknowledges all pending events | 83 | SATISFIED |
| MIG-01: Demo animation game migrated | 84 | SATISFIED |
| MIG-02: Cribbage game migrated | 84 | SATISFIED |
| MIG-03: BREAKING.md updated | 84 | SATISFIED |
| MIG-04: Documentation updated | 84 | SATISFIED |

**Score: 21/21 requirements satisfied**

## Phase Verification

| Phase | Status | Score | Tests |
|-------|--------|-------|-------|
| 80: Mutation Capture | Passed | 5/5 | 39 tests (mutation-capture.test.ts) |
| 81: Theatre State Engine | Passed | 4/4 | 40 tests (theatre-state.test.ts) |
| 82: Session Integration | Passed | 4/4 | 15 tests (session animation-events.test.ts) + 10 unit tests |
| 83: UI Composables | Passed | 5/5 | 30 tests (useAnimationEvents.test.ts) + 5 tests (useCurrentView.test.ts) |
| 84: Clean Break and Migration | Passed | 5/5 | 633 total tests passing, 0 failures |

**Score: 5/5 phases passed verification**

## Cross-Phase Integration

| Flow | Status |
|------|--------|
| Animation event creation (game.animate -> capture -> theatre snapshot -> buffer) | COMPLETE |
| Theatre state (snapshot -> theatreStateForPlayer -> buildPlayerState -> client) | COMPLETE |
| Acknowledgment (UI -> GameConnection -> WebSocket -> server -> engine -> broadcast) | COMPLETE |
| Skip (skipAll -> acknowledge last ID -> server advance -> broadcast truth) | COMPLETE |
| ActionPanel gating (isAnimating -> show/hide panel -> skip button) | COMPLETE |
| Serialization round-trip (toJSON -> theatreSnapshot + events -> restoreGame) | COMPLETE |
| Game migration (emitAnimationEvent removed -> game.animate in all games) | COMPLETE |

**Score: 7/7 E2E flows verified**

All 18 cross-phase exports consumed by downstream phases. Zero orphaned exports. Zero dead code from old API. TypeScript compilation clean. Barrel export chains intact through element/index.ts -> engine/index.ts -> ui/index.ts.

## Tech Debt

### Phase 83: UI Composables
- `GameShell.vue` uses `as any` casts for `animationEvents` and `currentView` fields because client `PlayerState` type lacks these server-sent fields (matches existing pattern for `actionMetadata` and `canUndo`)

### Phase 84: Clean Break and Migration
- `BREAKING.md` incorrectly states the `group` option was removed from the animation API, but `game.animate()` actually accepts `{ group?: string }` as an optional parameter. The JSDoc on the method itself is correct.

**Total: 3 items across 2 phases**

## Anti-Patterns

No blocker or warning-level anti-patterns found across any phase. The `as any` casts in GameShell.vue are an existing pattern used for other server-sent fields, not a regression.

## Compilation & Tests

- **TypeScript:** `tsc --noEmit` -- zero errors
- **Vitest:** 633 tests across 24 files -- zero failures
- **Regressions:** None

---
*Audited: 2026-02-07*
*Auditor: Claude (gsd-integration-checker + orchestrator)*
