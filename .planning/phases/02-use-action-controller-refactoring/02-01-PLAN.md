---
phase: 02-use-action-controller-refactoring
plan: 01
type: execute
---

<objective>
Analyze useActionController.ts and create extraction plan for Vue composable decomposition.

Purpose: Map the 1,807-line composable to identify extraction boundaries and establish the Vue composable extraction pattern (different from class extraction in Phase 1).
Output: Documented extraction plan with specific function groupings, verified human-approved.
</objective>

<execution_context>
~/.claude/get-shit-done/workflows/execute-phase.md
~/.claude/get-shit-done/templates/summary.md
~/.claude/get-shit-done/references/checkpoints.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/01-game-session-refactoring/01-04-SUMMARY.md

# Target file
@packages/ui/src/composables/useActionController.ts

# Vue composable patterns
@packages/ui/src/composables/useBoardInteraction.ts
@packages/ui/src/composables/useGameViewHelpers.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Document current structure and identify extraction boundaries</name>
  <files>.planning/phases/02-use-action-controller-refactoring/02-ANALYSIS.md</files>
  <action>
Analyze useActionController.ts and create 02-ANALYSIS.md documenting:

1. **Current Structure** (with line counts):
   - Types/interfaces section (~350 lines)
   - State refs and their dependencies
   - Helper functions (internal)
   - Computed values
   - Watchers
   - Core methods (execute, start, fill, etc.)
   - Injection helpers

2. **Proposed Extractions** (3 composables):

   a. **useSelectionState** (~400 lines) - Selection management
      - State: collectedSelections, selectionSnapshots
      - Methods: fill, skip, clear, validateSelection
      - Helpers: getChoices, getValidElements, findDisplayForValue
      - Computed: currentSelection, validElements, isReady

   b. **useFollowUp** (~250 lines) - FollowUp action chaining
      - State: pendingFollowUp
      - Methods: startFollowUp, scheduleFollowUp
      - Logic: followUp metadata handling, display overrides

   c. **useActionExecution** (~300 lines) - Action execution
      - State: isExecuting, lastError
      - Methods: execute, executeCurrentAction
      - Helpers: buildServerArgs

3. **Remaining in useActionController** (~600 lines):
   - Types (kept for public API)
   - Composition of extracted composables
   - start() method (orchestrates)
   - Repeating selection handling (complex, keep together)
   - Public API surface

4. **Key Differences from Phase 1** (class vs composable):
   - No `this` binding - pass dependencies explicitly
   - Refs are shared, not copied
   - Composables return reactive values, not class instances
   - No constructor - initialize inline or via factory

Document the extraction order: selection → followUp → execution (each builds on prior).
  </action>
  <verify>File exists with all sections filled in</verify>
  <done>02-ANALYSIS.md created with complete structure documentation</done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <what-built>Extraction plan for useActionController decomposition</what-built>
  <how-to-verify>
    1. Read: .planning/phases/02-use-action-controller-refactoring/02-ANALYSIS.md
    2. Review proposed composable boundaries
    3. Confirm extraction order makes sense
    4. Verify no critical dependencies missed
  </how-to-verify>
  <resume-signal>Type "approved" to proceed with extraction, or describe adjustments needed</resume-signal>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] 02-ANALYSIS.md exists with complete structure
- [ ] All function groupings documented
- [ ] Dependencies between groups identified
- [ ] Extraction order defined
- [ ] Human approved the plan
</verification>

<success_criteria>

- Analysis document created
- Extraction boundaries clearly defined
- Human verified the approach
- Ready to proceed with extraction plans
</success_criteria>

<output>
After completion, create `.planning/phases/02-use-action-controller-refactoring/02-01-SUMMARY.md`
</output>
