---
phase: 03-action-refactoring
plan: 03
type: execute
---

<objective>
Verify final action.ts structure and document refactoring results.

Purpose: Ensure refactoring maintains all behavior and public API, document final structure.
Output: Verified build/tests, updated exports, documented architecture.
</objective>

<execution_context>
~/.claude/get-shit-done/workflows/execute-phase.md
~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/03-action-refactoring/03-ANALYSIS.md
@.planning/phases/03-action-refactoring/03-01-SUMMARY.md
@.planning/phases/03-action-refactoring/03-02-SUMMARY.md
@packages/engine/src/action/action.ts
@packages/engine/src/action/index.ts

**Prior plans:**
- 03-01 extracted ConditionTracer and dev utilities (~85 lines)
- 03-02 extracted Action builder class (~340 lines)
- action.ts now ~1,420 lines (ActionExecutor)
</context>

<tasks>

<task type="auto">
  <name>Task 1: Verify final module structure</name>
  <files>packages/engine/src/action/</files>
  <action>
List and verify the final module structure:

Expected files:
- action.ts - ActionExecutor class (~1,420 lines)
- action-builder.ts - Action class (~400 lines with helper)
- condition-tracer.ts - ConditionTracer class (~60 lines)
- helpers.ts - Filter helpers + dev utilities (~340 lines)
- types.ts - Type definitions (~563 lines, unchanged)
- index.ts - Re-exports

Verify each file has correct imports and exports.
Check that index.ts exports all public API items.
  </action>
  <verify>ls -la packages/engine/src/action/ shows expected files, wc -l confirms sizes</verify>
  <done>Module structure verified: 6 files, action.ts ~1,420 lines</done>
</task>

<task type="auto">
  <name>Task 2: Run comprehensive test suite</name>
  <files>packages/engine/tests/</files>
  <action>
Run full engine test suite and verify no regressions:
1. npm test -w @boardsmith/engine -- --run
2. Check all 95+ tests pass
3. Verify action.test.ts specifically has no failures

Also run the monorepo build to ensure dependent packages work:
1. npm run build
2. Verify no import errors in downstream packages
  </action>
  <verify>All engine tests pass, monorepo builds successfully</verify>
  <done>All tests pass (95+), monorepo build succeeds</done>
</task>

<task type="auto">
  <name>Task 3: Verify public API unchanged</name>
  <files>packages/engine/src/action/index.ts</files>
  <action>
Verify all public exports are preserved:

Required exports (from index.ts):
- Action class
- ActionExecutor class
- ConditionTracer class
- All types from types.ts
- All helpers from helpers.ts (dependentFilter, adjacentToSelection, etc.)
- actionTempState helper

Check that no exports were accidentally removed or renamed.
Check that import paths in other packages still work.
  </action>
  <verify>grep for imports of @boardsmith/engine action items shows no errors</verify>
  <done>Public API verified: all exports present, no breaking changes</done>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] Module structure verified (6 files in action/)
- [ ] All engine tests pass (npm test -w @boardsmith/engine)
- [ ] Monorepo build succeeds (npm run build)
- [ ] Public API unchanged (all exports present)
- [ ] action.ts at ~1,420 lines (down from 1,845)
</verification>

<success_criteria>

- All tasks completed
- All verification checks pass
- action.ts reduced from 1,845 â†’ ~1,420 lines (23% reduction)
- Total action module: ~2,780 lines across 5 source files (was 2,718 across 3 files)
- Public API unchanged
- Phase 3 complete
</success_criteria>

<output>
After completion, create `.planning/phases/03-action-refactoring/03-03-SUMMARY.md`

This summary should include:
- Final line counts for each file
- Comparison to original structure
- Decision rationale: why ActionExecutor was kept intact
- Recommendation for Phase 4 (test file refactoring)
</output>
