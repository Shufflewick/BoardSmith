---
phase: 04-test-file-refactoring
plan: 01
type: execute
---

<objective>
Analyze the useActionController.test.ts structure and create a documented mapping to determine optimal test file organization.

Purpose: Understand the current test structure before restructuring to ensure no coverage is lost and the new organization mirrors the composable structure from Phase 2.
Output: Analysis document (04-ANALYSIS.md) mapping 23 describe blocks to proposed new file structure.
</objective>

<execution_context>
~/.claude/get-shit-done/workflows/execute-phase.md
~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/02-use-action-controller-refactoring/02-ANALYSIS.md
@.planning/phases/02-use-action-controller-refactoring/02-04-SUMMARY.md

**Phase 2 created these composable files:**
@packages/ui/src/composables/useActionController.ts
@packages/ui/src/composables/useActionControllerTypes.ts
@packages/ui/src/composables/actionControllerHelpers.ts
@packages/ui/src/composables/useGameViewEnrichment.ts

**Current test file to analyze:**
@packages/ui/tests/useActionController.test.ts

**Testing patterns:**
@.planning/codebase/TESTING.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Analyze test file structure and count tests per describe block</name>
  <files>.planning/phases/04-test-file-refactoring/04-ANALYSIS.md</files>
  <action>
Read useActionController.test.ts and analyze its structure:
1. List all 23 describe blocks with their line ranges and test counts
2. Identify shared test fixtures (createMockSendAction, createTestMetadata, beforeEach setup)
3. Calculate lines per section to inform split decisions

Create 04-ANALYSIS.md with:
- Table of describe blocks with line ranges, test counts
- Identification of dependencies between test sections
- Note which tests depend on shared fixtures
  </action>
  <verify>04-ANALYSIS.md exists with complete describe block inventory</verify>
  <done>All 23 describe blocks documented with line ranges and test counts</done>
</task>

<task type="auto">
  <name>Task 2: Map tests to proposed file structure</name>
  <files>.planning/phases/04-test-file-refactoring/04-ANALYSIS.md</files>
  <action>
Extend 04-ANALYSIS.md with proposed test file organization. Consider:

**Option A: Mirror composable files** (rejected by analysis - helpers/enrichment not directly tested)

**Option B: Group by feature area** (recommended):
1. `useActionController.test.ts` - Core API (execute, wizard mode, auto-fill/execute, state)
2. `useActionController.selections.test.ts` - Selection handling (repeating, dependsOn, filterBy, multiSelect, text/number, element)
3. `useActionController.choices.test.ts` - Choice fetching and utilities (selection choices, fetchChoicesForSelection, getChoices, getCurrentChoices)

**Option C: Minimal split** (alternative):
1. Keep most tests together
2. Only extract complex selection tests (repeating, dependsOn, filterBy) to separate file

Document:
- Proposed file structure with estimated line counts
- Which helper functions/fixtures need to be shared
- Decision rationale based on:
  - Logical grouping
  - Run time considerations (parallel test execution)
  - Maintenance (finding relevant tests)
  </action>
  <verify>04-ANALYSIS.md has proposed structure with rationale</verify>
  <done>Proposed test file organization documented with line estimates and shared fixture plan</done>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] 04-ANALYSIS.md exists with complete structure analysis
- [ ] All 23 describe blocks accounted for in proposed structure
- [ ] Shared fixtures identified
- [ ] Recommended approach documented with rationale
</verification>

<success_criteria>

- 04-ANALYSIS.md created with test structure analysis
- Proposed file organization documented
- Ready for Phase 4 Plan 02 execution
</success_criteria>

<output>
After completion, create `.planning/phases/04-test-file-refactoring/04-01-SUMMARY.md`
</output>
