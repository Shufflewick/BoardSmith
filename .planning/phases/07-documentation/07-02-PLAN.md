---
phase: 07-documentation
plan: 02
type: execute
---

<objective>
Remove unused `withChoices` parameter from assertActionAvailable function.

Purpose: Clean up incomplete API that has a TODO comment and unused parameter.
Output: Cleaner API without misleading parameter.
</objective>

<execution_context>
~/.claude/get-shit-done/workflows/execute-phase.md
./07-02-SUMMARY.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/codebase/CONCERNS.md

# Source file
@packages/testing/src/assertions.ts

**From CONCERNS.md - Test Coverage Gap:**
- File: `packages/testing/src/assertions.ts:248`
- Code: `// TODO: Add withChoices validation when action tracing is available`
- Issue: The `options?: { withChoices?: boolean }` parameter exists but does nothing

**Current state (lines 227-249):**
```typescript
export function assertActionAvailable(
  testGame: TestGame,
  playerIndex: number,
  actionName: string,
  options?: { withChoices?: boolean }
): void {
  // ... checks action availability ...

  // TODO: Add withChoices validation when action tracing is available
}
```

The `options` parameter is never used. This is misleading for callers who might think it does something.
</context>

<tasks>

<task type="auto">
  <name>Task 1: Remove unused options parameter from assertActionAvailable</name>
  <files>packages/testing/src/assertions.ts</files>
  <action>
1. Remove the `options?: { withChoices?: boolean }` parameter from the function signature
2. Remove the TODO comment about withChoices
3. Keep the function otherwise unchanged

Change from:
```typescript
export function assertActionAvailable(
  testGame: TestGame,
  playerIndex: number,
  actionName: string,
  options?: { withChoices?: boolean }
): void {
```

To:
```typescript
export function assertActionAvailable(
  testGame: TestGame,
  playerIndex: number,
  actionName: string
): void {
```

Also remove the TODO comment at line 248.
  </action>
  <verify>grep -n "withChoices" packages/testing/src/assertions.ts returns no results</verify>
  <done>assertActionAvailable has clean API without unused parameter</done>
</task>

<task type="auto">
  <name>Task 2: Verify no callers use the removed parameter</name>
  <files>packages/testing/src/assertions.ts</files>
  <action>
Search the codebase for any calls to assertActionAvailable with 4 arguments:

```bash
grep -r "assertActionAvailable.*,.*,.*," packages/ --include="*.ts"
```

If any callers pass the fourth argument, update them to remove it.

Note: The function is exported from @boardsmith/testing package, so check:
- packages/testing/tests/
- packages/games/*/tests/
- Any other test files
  </action>
  <verify>grep -r "assertActionAvailable.*withChoices" packages/ --include="*.ts" returns no results</verify>
  <done>No callers are using the removed parameter</done>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] `withChoices` parameter removed from assertActionAvailable
- [ ] TODO comment removed
- [ ] No callers broken by the change
- [ ] `npm run typecheck` passes
- [ ] `npm test` passes (if testing package has tests)
</verification>

<success_criteria>

- assertActionAvailable has clean 3-parameter signature
- No misleading unused parameter in public API
- All existing code continues to work
</success_criteria>

<output>
After completion, create `.planning/phases/07-documentation/07-02-SUMMARY.md`
</output>
