---
phase: 15-game-migrations
plan: 01
type: execute
---

<objective>
Migrate all BoardSmith game conditions from function format to object format.

Purpose: Enable automatic condition tracing for better debugging in all games.
Output: All 7 games use object-based conditions with descriptive labels.
</objective>

<execution_context>
~/.claude/get-shit-done/workflows/execute-phase.md
./summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/14-condition-api-refactor/14-01-SUMMARY.md
@.planning/phases/14-condition-api-refactor/14-02-SUMMARY.md

**Migration pattern:**
```typescript
// BEFORE (function format - no debug labels)
.condition((ctx) => ctx.player.hand.count() > 0)

// AFTER (object format - auto-traced labels)
.condition({
  'has cards in hand': (ctx) => ctx.player.hand.count() > 0,
})
```

**For multi-condition checks, split into labeled parts:**
```typescript
// BEFORE
.condition((ctx) => {
  const player = ctx.player as DemoPlayer;
  return game.getPlayerHand(player).count(Card) > 0 && game.all(Player).length > 1;
})

// AFTER
.condition({
  'has cards in hand': (ctx) => game.getPlayerHand(ctx.player as DemoPlayer).count(Card) > 0,
  'multiple players in game': () => game.all(Player).length > 1,
})
```

**Games to migrate (18 total conditions):**
- cribbage: 4 conditions
- checkers: 2 conditions
- go-fish: 1 condition
- demoActionPanel: 2 conditions
- floss-bitties: 3 conditions
- demoComplexUiInteractions: 5 conditions
- polyhedral-potions: 1 condition
</context>

<tasks>

<task type="auto">
  <name>Task 1: Migrate simple games (go-fish, polyhedral-potions, demoActionPanel)</name>
  <files>packages/games/go-fish/rules/src/actions.ts, packages/games/polyhedral-potions/rules/src/actions.ts, packages/games/demoActionPanel/rules/src/actions.ts</files>
  <action>
Convert function conditions to object format in these 3 files (5 conditions total):

1. **go-fish (1 condition):** Line 75 - convert `canPlayerTakeAction` check to labeled object

2. **polyhedral-potions (1 condition):** Line 96 - convert dice check to labeled object

3. **demoActionPanel (2 conditions):**
   - Line 16: Multi-check condition - split into labeled parts for units/enemies
   - Line 191: Simple player count check - use descriptive label

Use descriptive labels that explain WHY the condition exists, not just what it checks.
  </action>
  <verify>npm run build passes, npm test passes</verify>
  <done>5 conditions converted in 3 files, build and tests pass</done>
</task>

<task type="auto">
  <name>Task 2: Migrate card games (cribbage, floss-bitties)</name>
  <files>packages/games/cribbage/rules/src/actions.ts, packages/games/floss-bitties/src/rules/actions.ts</files>
  <action>
Convert function conditions to object format in these 2 files (7 conditions total):

1. **cribbage (4 conditions):**
   - Line 30: discardToCrib condition - check game state and cards
   - Line 84: playCard condition - check game phase and playable cards
   - Line 133: sayGo condition - check if player can't play
   - Line 180: acknowledgeScoringAnimation condition - check for active animation

2. **floss-bitties (3 conditions):**
   - Line 22: playCard condition - check playable cards
   - Line 86: draw condition - check deck has cards
   - Line 131: drawFromDiscard condition - check drawable piles

Split compound conditions (&&) into separate labeled predicates.
  </action>
  <verify>npm run build passes, npm test passes</verify>
  <done>7 conditions converted in 2 files, build and tests pass</done>
</task>

<task type="auto">
  <name>Task 3: Migrate remaining games (checkers, demoComplexUiInteractions)</name>
  <files>packages/games/checkers/rules/src/actions.ts, packages/games/demoComplexUiInteractions/src/rules/actions.ts</files>
  <action>
Convert function conditions to object format in these 2 files (7 conditions total):

1. **checkers (2 conditions):**
   - Line 14: endTurn condition - check turn state and jump status
   - Line 160: move condition - complex multi-jump logic

2. **demoComplexUiInteractions (5 conditions):**
   - Line 26: draw condition - deck check
   - Line 61: playCard condition - hand check
   - Line 106: tradeCards condition - hand + multiplayer check
   - Line 166: giveCard condition - hand + multiplayer check
   - Line 215: discardCard condition - hand check

Split all compound conditions into separate labeled predicates.
  </action>
  <verify>npm run build passes, npm test passes</verify>
  <done>7 conditions converted in 2 files, build and tests pass, all 18 game conditions migrated</done>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] `npm run build` succeeds without errors
- [ ] `npm test` passes all tests
- [ ] All 18 game conditions use object format
- [ ] No function-style .condition() calls remain in packages/games/
</verification>

<success_criteria>

- All tasks completed
- All verification checks pass
- All game conditions converted to object format with descriptive labels
- No regressions in game behavior
</success_criteria>

<output>
After completion, create `.planning/phases/15-game-migrations/15-01-SUMMARY.md`
</output>
