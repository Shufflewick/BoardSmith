---
phase: 15-game-migrations
plan: 02
type: execute
---

<objective>
Migrate all test file conditions from function format to object format.

Purpose: Test files should demonstrate best practices and use the new API.
Output: All test conditions use object-based format with descriptive labels.
</objective>

<execution_context>
~/.claude/get-shit-done/workflows/execute-phase.md
./summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/15-game-migrations/15-01-SUMMARY.md

**Migration pattern (same as Plan 01):**
```typescript
// BEFORE
.condition((ctx) => ctx.player.position === 1)

// AFTER
.condition({
  'player is first': (ctx) => ctx.player.position === 1,
})
```

**Test files to migrate (8 total conditions):**
- packages/engine/tests/action.test.ts: 6 conditions
- packages/engine/tests/flow.test.ts: 1 condition
- packages/runtime/tests/runner.test.ts: 1 condition
</context>

<tasks>

<task type="auto">
  <name>Task 1: Migrate engine action tests</name>
  <files>packages/engine/tests/action.test.ts</files>
  <action>
Convert 6 function conditions to object format:

- Line 119: position check condition
- Line 426: `() => false` - use label like 'never available'
- Line 562: `() => true` - use label like 'always available'
- Line 570: `() => false` - use label like 'blocked'
- Line 1076: `() => true` - use label like 'enabled'
- Line 1080: `() => false` - use label like 'disabled'

For simple boolean conditions, use descriptive test-context labels.
  </action>
  <verify>npm run build passes, npm test passes (specifically action.test.ts)</verify>
  <done>6 conditions converted in action.test.ts, tests pass</done>
</task>

<task type="auto">
  <name>Task 2: Migrate flow and runner tests</name>
  <files>packages/engine/tests/flow.test.ts, packages/runtime/tests/runner.test.ts</files>
  <action>
Convert 2 function conditions to object format:

1. **flow.test.ts (line 608):** Deck existence and card count check - split into labeled parts

2. **runner.test.ts (line 55):** Deck card count check - convert to labeled object

Use descriptive labels that explain what the test is checking.
  </action>
  <verify>npm run build passes, npm test passes (specifically flow.test.ts and runner.test.ts)</verify>
  <done>2 conditions converted, all 8 test conditions migrated, all tests pass</done>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] `npm run build` succeeds without errors
- [ ] `npm test` passes all tests
- [ ] All 8 test conditions use object format
- [ ] No function-style .condition() calls remain in test files
</verification>

<success_criteria>

- All tasks completed
- All verification checks pass
- All test conditions converted to object format
- Test files demonstrate recommended API usage
</success_criteria>

<output>
After completion, create `.planning/phases/15-game-migrations/15-02-SUMMARY.md`
</output>
