---
phase: 20-simulator-exports
plan: 01
type: execute
---

<objective>
Export `simulateSingleGame` and prepare serializable simulation options for worker threads.

Purpose: Enable parallel game simulations in Phase 21 by making the single-game simulation function public and providing serializable types for cross-thread communication.
Output: Exported `simulateSingleGame` function, serializable type definitions, and serialize/deserialize helper functions.
</objective>

<execution_context>
~/.claude/get-shit-done/workflows/execute-phase.md
./20-01-SUMMARY.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@packages/ai-trainer/src/simulator.ts
@packages/ai-trainer/src/types.ts
@packages/ai-trainer/src/index.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add serializable type definitions</name>
  <files>packages/ai-trainer/src/types.ts</files>
  <action>
    Add SerializableElementTypeInfo interface (converts Set to array for stringEnums).
    Add SerializableGameStructure interface (converts Map to Record, uses SerializableElementTypeInfo).
    Add SingleGameOptions interface (subset of SimulationOptions without gameCount/onProgress).
    Add SerializableSimulationOptions interface (all structured-cloneable fields for worker communication).
  </action>
  <verify>pnpm --filter @boardsmith/ai-trainer build compiles without errors</verify>
  <done>All four interfaces exist and compile cleanly</done>
</task>

<task type="auto">
  <name>Task 2: Export simulateSingleGame and add serialization helpers</name>
  <files>packages/ai-trainer/src/simulator.ts</files>
  <action>
    Change simulateSingleGame from private to exported function.
    Update its parameter type from SimulationOptions to SingleGameOptions.
    Add serializeGameStructure() function to convert GameStructure to SerializableGameStructure.
    Add deserializeGameStructure() function to convert back.
  </action>
  <verify>pnpm --filter @boardsmith/ai-trainer build succeeds</verify>
  <done>simulateSingleGame is exported, serialization helpers work correctly</done>
</task>

<task type="auto">
  <name>Task 3: Update package exports</name>
  <files>packages/ai-trainer/src/index.ts</files>
  <action>
    Export simulateSingleGame, serializeGameStructure, deserializeGameStructure from simulator.js.
    Export SingleGameOptions, SerializableElementTypeInfo, SerializableGameStructure, SerializableSimulationOptions from types.js.
  </action>
  <verify>pnpm build succeeds for all packages</verify>
  <done>All new exports available from @boardsmith/ai-trainer</done>
</task>

</tasks>

<verification>
Before declaring phase complete:
- [ ] `pnpm --filter @boardsmith/ai-trainer build` succeeds
- [ ] `pnpm test` passes (all non-e2e tests)
- [ ] Exports verified: `simulateSingleGame`, `serializeGameStructure`, `deserializeGameStructure`
- [ ] Type exports verified: `SingleGameOptions`, `SerializableGameStructure`, `SerializableSimulationOptions`
</verification>

<success_criteria>

- All tasks completed
- All verification checks pass
- simulateSingleGame is publicly exported
- SerializableSimulationOptions and related types exist
- Existing runSimulations behavior unchanged
- All tests pass
</success_criteria>

<output>
After completion, create `.planning/phases/20-simulator-exports/20-01-SUMMARY.md`
</output>
