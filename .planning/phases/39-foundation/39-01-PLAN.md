---
phase: 39-foundation
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - package.json
  - pnpm-workspace.yaml (deleted)
  - pnpm-lock.yaml (deleted)
  - package-lock.json (created)
autonomous: true

must_haves:
  truths:
    - "npm install runs without errors"
    - "No pnpm-specific files exist in repository root"
    - "package.json has name 'boardsmith' and exports field"
    - "package-lock.json exists and is valid JSON"
  artifacts:
    - path: "package.json"
      provides: "Single-package npm configuration"
      contains: '"exports"'
    - path: "package-lock.json"
      provides: "npm dependency lock file"
      min_lines: 100
  key_links:
    - from: "package.json"
      to: "packages/engine/dist/index.js"
      via: "exports field"
      pattern: 'exports.*packages/engine/dist'
---

<objective>
Migrate BoardSmith from pnpm monorepo to npm single-package structure.

Purpose: Establish foundation for v2.0 monorepo collapse. This phase switches tooling only - source reorganization happens in Phase 40.

Output:
- pnpm files deleted (pnpm-workspace.yaml, pnpm-lock.yaml)
- package.json updated with exports field, no workspace config
- package-lock.json generated by npm install
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/39-foundation/39-RESEARCH.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Remove pnpm configuration and update package.json</name>
  <files>package.json, pnpm-workspace.yaml, pnpm-lock.yaml</files>
  <action>
1. Delete pnpm-specific files:
   - `rm pnpm-workspace.yaml`
   - `rm pnpm-lock.yaml`

2. Delete node_modules to avoid pnpm/npm conflicts:
   - `rm -rf node_modules`

3. Update package.json:
   - Remove `"pnpm"` object (lines 2-6)
   - Remove `"workspaces"` array (lines 11-14)
   - Remove `"private": true` (line 9) - we want this to be publishable
   - Update `"scripts"` to remove workspace-dependent commands:
     - Remove `"build": "npm run build --workspaces --if-present"` (won't work without workspaces)
     - Remove `"cli": "npm run cli --workspace=@boardsmith/cli"` (workspace reference)
     - Keep `"test"`, `"test:watch"`, `"lint"`, `"regen:llms"`
   - Add `"exports"` field pointing to engine (minimal foundation):
     ```json
     "exports": {
       ".": {
         "types": "./packages/engine/dist/index.d.ts",
         "import": "./packages/engine/dist/index.js"
       }
     }
     ```
   - Add `"description": "Library for designing digital board games"`

Final package.json structure (essential fields):
```json
{
  "name": "boardsmith",
  "version": "0.0.1",
  "type": "module",
  "description": "Library for designing digital board games",
  "exports": {
    ".": {
      "types": "./packages/engine/dist/index.d.ts",
      "import": "./packages/engine/dist/index.js"
    }
  },
  "scripts": {
    "test": "vitest run",
    "test:watch": "vitest --watch",
    "regen:llms": "npx repomix",
    "lint": "eslint packages/"
  },
  "devDependencies": { ... existing ... },
  "engines": { "node": ">=20" }
}
```
  </action>
  <verify>
- `ls pnpm-workspace.yaml` returns "No such file"
- `ls pnpm-lock.yaml` returns "No such file"
- `cat package.json | grep -c '"workspaces"'` returns 0
- `cat package.json | grep -c '"pnpm"'` returns 0
- `cat package.json | grep '"exports"'` shows exports field exists
- `cat package.json | grep '"private"'` returns nothing (field removed)
  </verify>
  <done>
- pnpm-workspace.yaml deleted
- pnpm-lock.yaml deleted
- node_modules deleted
- package.json has no workspace config, no pnpm config, no private flag
- package.json has exports field pointing to packages/engine/dist
  </done>
</task>

<task type="auto">
  <name>Task 2: Generate npm lock file and verify installation</name>
  <files>package-lock.json</files>
  <action>
1. Run `npm install` to generate package-lock.json

   This will:
   - Install devDependencies from package.json
   - Generate package-lock.json
   - Create node_modules with npm structure (flat, not pnpm symlinks)

2. Verify the generated files:
   - package-lock.json should be valid JSON
   - package-lock.json should have lockfileVersion 3 (npm v7+)
   - node_modules should exist with installed packages

NOTE: Tests will NOT pass at this point because:
- Sub-packages still have `workspace:*` dependencies (fixed in Phase 43)
- Build scripts were removed (restored in Phase 40)

This is expected. Phase 39 only establishes npm tooling foundation.
  </action>
  <verify>
- `npm install` exits with code 0
- `ls package-lock.json` shows file exists
- `head -5 package-lock.json` shows valid JSON with "lockfileVersion": 3
- `ls node_modules` shows directory exists
- `which npm` confirms npm is being used (not pnpm)
  </verify>
  <done>
- package-lock.json exists and is valid
- npm install completes successfully
- node_modules created with npm structure
  </done>
</task>

</tasks>

<verification>
Phase 39 requirements verification:

**PKG-01** (foundation): Single `boardsmith` package.json exists
- `cat package.json | grep '"name": "boardsmith"'`

**PKG-13**: npm instead of pnpm
- `ls pnpm-*.yaml` returns "No such file"
- `ls package-lock.json` shows file exists

**SRC-14**: Single root package.json with exports field
- `cat package.json | grep -A5 '"exports"'` shows exports configuration

All three requirements addressed in this phase.
</verification>

<success_criteria>
1. No pnpm files exist (pnpm-workspace.yaml, pnpm-lock.yaml)
2. package.json has name "boardsmith" with exports field
3. package-lock.json exists and is valid
4. npm install runs without errors
5. No workspace configuration in package.json
</success_criteria>

<output>
After completion, create `.planning/phases/39-foundation/39-01-SUMMARY.md`
</output>
