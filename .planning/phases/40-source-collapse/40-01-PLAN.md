---
phase: 40-source-collapse
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - src/engine/**
  - src/runtime/**
  - src/ai/**
  - src/ai-trainer/**
  - src/testing/**
  - src/session/**
autonomous: true

must_haves:
  truths:
    - "Engine source files exist in src/engine/"
    - "Runtime source files exist in src/runtime/"
    - "AI source files exist in src/ai/"
    - "AI trainer source files exist in src/ai-trainer/"
    - "Testing source files exist in src/testing/"
    - "Session source files exist in src/session/"
    - "Git history preserved for all moved files"
  artifacts:
    - path: "src/engine/index.ts"
      provides: "Engine barrel export"
    - path: "src/runtime/index.ts"
      provides: "Runtime barrel export"
    - path: "src/ai/index.ts"
      provides: "AI barrel export"
    - path: "src/ai-trainer/index.ts"
      provides: "AI trainer barrel export"
    - path: "src/testing/index.ts"
      provides: "Testing barrel export"
    - path: "src/session/index.ts"
      provides: "Session barrel export"
  key_links:
    - from: "packages/engine/src/"
      to: "src/engine/"
      via: "git mv"
      pattern: "renamed.*engine"
---

<objective>
Move foundation package sources (engine, runtime, ai, ai-trainer, testing, session) to unified src/ directory structure.

Purpose: Consolidate core library packages into single-package structure as first half of source collapse.
Output: 84 source files moved from packages/*/src/ to src/*/, git history preserved.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/40-source-collapse/40-RESEARCH.md
@.planning/phases/39-foundation/39-01-SUMMARY.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create directory structure and move foundation packages</name>
  <files>
    src/engine/**
    src/runtime/**
    src/ai/**
    src/ai-trainer/**
    src/testing/**
    src/session/**
  </files>
  <action>
Create the target directory structure and move foundation packages using git mv:

1. Create directories:
```bash
mkdir -p src/engine src/runtime src/ai src/ai-trainer src/testing src/session
```

2. Move each package's src/ contents (preserves subdirectory structure):
```bash
# Engine (42 files) - has subdirectories
git mv packages/engine/src/* src/engine/

# Runtime (2 files)
git mv packages/runtime/src/* src/runtime/

# AI (4 files)
git mv packages/ai/src/* src/ai/

# AI Trainer (17 files)
git mv packages/ai-trainer/src/* src/ai-trainer/

# Testing (7 files)
git mv packages/testing/src/* src/testing/

# Session (12 files)
git mv packages/session/src/* src/session/
```

3. Verify each move shows as "renamed" not "deleted/new" in git status.

IMPORTANT:
- Use `git mv` not `cp`/`rm` to preserve history
- Do NOT move test files (packages/*/tests/) - that's Phase 41
- Do NOT move packages/ai/debug-bot.ts - it's outside src/
- Do NOT move packages/ai-trainer/scripts/ - they're outside src/
  </action>
  <verify>
```bash
# Should show 84 files total in these directories
find src/engine src/runtime src/ai src/ai-trainer src/testing src/session -type f | wc -l

# Should show "renamed:" for all files, no "deleted:" or "new file:"
git status | grep -E "renamed:|deleted:|new file:" | head -20
```
  </verify>
  <done>
- src/engine/ contains 42 files (including subdirectories action/, command/, element/, flow/, player/, sandbox/, scoring/, utils/)
- src/runtime/ contains 2 files
- src/ai/ contains 4 files
- src/ai-trainer/ contains 17 files
- src/testing/ contains 7 files
- src/session/ contains 12 files
- All files show as "renamed" in git status
  </done>
</task>

<task type="auto">
  <name>Task 2: Commit foundation package moves</name>
  <files>None (git operation only)</files>
  <action>
Commit all foundation package moves as a single atomic commit:

```bash
git add -A
git commit -m "refactor(40-01): move foundation packages to src/

Move core package sources to unified src/ structure:
- engine (42 files) -> src/engine/
- runtime (2 files) -> src/runtime/
- ai (4 files) -> src/ai/
- ai-trainer (17 files) -> src/ai-trainer/
- testing (7 files) -> src/testing/
- session (12 files) -> src/session/

Total: 84 files moved, git history preserved.
Imports not updated yet (Phase 43).

Requirements: SRC-01, SRC-03, SRC-05, SRC-07, SRC-08, SRC-11"
```
  </action>
  <verify>
```bash
# Commit should exist
git log --oneline -1

# Working tree should be clean
git status --porcelain | wc -l
```
  </verify>
  <done>
- Commit created with descriptive message
- Working tree is clean
- 84 files committed as renames
  </done>
</task>

</tasks>

<verification>
After all tasks complete:

1. **File count verification:**
   ```bash
   find src -type f | wc -l
   # Expected: 84
   ```

2. **Directory structure verification:**
   ```bash
   ls -la src/
   # Should show: engine, runtime, ai, ai-trainer, testing, session
   ```

3. **Git history verification:**
   ```bash
   git log --follow --oneline src/engine/index.ts | head -5
   # Should show history predating this commit
   ```

4. **Nothing left behind:**
   ```bash
   ls packages/engine/src packages/runtime/src packages/ai/src packages/ai-trainer/src packages/testing/src packages/session/src 2>&1 | grep -v "No such file"
   # Should be empty (directories gone or empty)
   ```
</verification>

<success_criteria>
- SRC-01 satisfied: src/engine/ contains core game logic (42 files)
- SRC-03 satisfied: src/session/ contains game session (12 files)
- SRC-05 satisfied: src/testing/ contains test utilities (7 files)
- SRC-07 satisfied: src/ai/ contains AI/MCTS logic (4 files)
- SRC-08 satisfied: src/ai-trainer/ contains training (17 files)
- SRC-11 satisfied: src/runtime/ contains shared runtime (2 files)
- Git history preserved for all 84 files
- Single atomic commit for all moves
</success_criteria>

<output>
After completion, create `.planning/phases/40-source-collapse/40-01-SUMMARY.md`
</output>
