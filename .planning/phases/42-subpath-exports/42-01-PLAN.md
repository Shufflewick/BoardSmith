---
phase: 42-subpath-exports
plan: 01
type: execute
wave: 1
depends_on: []
files_modified: [package.json]
autonomous: true

must_haves:
  truths:
    - "import { Game } from 'boardsmith' resolves to src/engine/"
    - "import { BoardView } from 'boardsmith/ui' resolves to src/ui/"
    - "All 11 subpath exports resolve correctly in external project"
    - "TypeScript understands types from all exports (no any/unknown)"
  artifacts:
    - path: "package.json"
      provides: "11 subpath exports pointing to src/*/index.ts"
      contains: '"./ui":'
    - path: "/private/tmp/boardsmith-test-target/test-imports.ts"
      provides: "Import verification test file"
      contains: "from 'boardsmith'"
  key_links:
    - from: "package.json exports"
      to: "src/*/index.ts"
      via: "types and import conditions"
      pattern: '"types": "./src/'
---

<objective>
Configure all 11 subpath exports in package.json for the collapsed monorepo structure.

Purpose: Enable consumers to import from boardsmith subpaths (boardsmith/ui, boardsmith/session, etc.) instead of @boardsmith/* packages. This completes the package structure transition.

Output: Updated package.json with exports field, verified working with external test project.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/42-subpath-exports/42-RESEARCH.md

Reference files:
@package.json
@src/engine/index.ts
@src/ui/index.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Configure 11 subpath exports in package.json</name>
  <files>package.json</files>
  <action>
Update package.json exports field with all 11 subpaths. Each export must have `types` FIRST (critical for TypeScript resolution), then `import`.

Replace current exports:
```json
"exports": {
  ".": {
    "types": "./packages/engine/dist/index.d.ts",
    "import": "./packages/engine/dist/index.js"
  }
}
```

With complete exports pointing to source files:
```json
"exports": {
  ".": {
    "types": "./src/engine/index.ts",
    "import": "./src/engine/index.ts"
  },
  "./ui": {
    "types": "./src/ui/index.ts",
    "import": "./src/ui/index.ts"
  },
  "./session": {
    "types": "./src/session/index.ts",
    "import": "./src/session/index.ts"
  },
  "./testing": {
    "types": "./src/testing/index.ts",
    "import": "./src/testing/index.ts"
  },
  "./eslint-plugin": {
    "types": "./src/eslint-plugin/index.ts",
    "import": "./src/eslint-plugin/index.ts"
  },
  "./ai": {
    "types": "./src/ai/index.ts",
    "import": "./src/ai/index.ts"
  },
  "./ai-trainer": {
    "types": "./src/ai-trainer/index.ts",
    "import": "./src/ai-trainer/index.ts"
  },
  "./client": {
    "types": "./src/client/index.ts",
    "import": "./src/client/index.ts"
  },
  "./server": {
    "types": "./src/server/index.ts",
    "import": "./src/server/index.ts"
  },
  "./runtime": {
    "types": "./src/runtime/index.ts",
    "import": "./src/runtime/index.ts"
  },
  "./worker": {
    "types": "./src/worker/index.ts",
    "import": "./src/worker/index.ts"
  }
}
```

Requirements covered: PKG-02, PKG-03, PKG-04, PKG-05, PKG-06, PKG-07, PKG-08, PKG-09, PKG-10, PKG-11, PKG-12
  </action>
  <verify>
- Run `npm test` to verify existing tests still pass
- Check package.json has 11 export entries (including ".")
  </verify>
  <done>
- package.json exports field has 11 subpath entries
- Each entry has `types` condition first, then `import`
- All paths start with `./src/`
- Existing tests pass
  </done>
</task>

<task type="auto">
  <name>Task 2: Verify exports with external test project</name>
  <files>/private/tmp/boardsmith-test-target/test-imports.ts, /private/tmp/boardsmith-test-target/package.json, /private/tmp/boardsmith-test-target/tsconfig.json</files>
  <action>
Create external test project at /private/tmp/boardsmith-test-target/ to verify exports resolve correctly.

1. Create package.json:
```json
{
  "name": "boardsmith-test-target",
  "type": "module",
  "dependencies": {
    "boardsmith": "file:/Users/jtsmith/board_game_service/BoardSmith"
  }
}
```

2. Create tsconfig.json:
```json
{
  "compilerOptions": {
    "target": "ES2022",
    "module": "ESNext",
    "moduleResolution": "bundler",
    "strict": true,
    "noEmit": true,
    "skipLibCheck": true
  },
  "include": ["*.ts"]
}
```

3. Create test-imports.ts that imports from all 11 subpaths:
```typescript
// Test all subpath exports
import { Game, Action, Flow } from 'boardsmith';
import { BoardView, useBoardInteraction } from 'boardsmith/ui';
import { GameSession } from 'boardsmith/session';
import { createTestGame } from 'boardsmith/testing';
import { createBot } from 'boardsmith/ai';
import { GameRunner } from 'boardsmith/runtime';
import { AITrainer } from 'boardsmith/ai-trainer';
// Note: client, server, worker, eslint-plugin have fewer public exports

// Type checks - ensure types resolve (not any)
const _game: Game<any, any> = null as any;
const _session: GameSession<any, any> = null as any;

console.log('All imports resolved successfully');
```

4. Run npm install in test project
5. Run `npx tsc --noEmit` to verify TypeScript resolves all types

Note: Some subpaths may have limited exports. The test should verify at least the main entry point (.) plus ui, session, testing, ai, runtime which are commonly used.
  </action>
  <verify>
- `npx tsc --noEmit` in test project produces no errors
- All 11 subpath imports resolve (may need to adjust actual export names based on what each index.ts exports)
  </verify>
  <done>
- External test project successfully imports from all subpaths
- TypeScript type resolution works (no any/unknown types)
- Verification proves the exports configuration is correct
  </done>
</task>

</tasks>

<verification>
Phase 42 is complete when:
1. package.json has 11 exports with correct condition ordering
2. `npm test` passes in main project
3. External test project can import and type-check all subpaths
</verification>

<success_criteria>
- PKG-02 through PKG-12 requirements satisfied
- All 11 subpath exports configured and verified
- TypeScript resolves types correctly for bundler consumers
- No regressions in existing test suite
</success_criteria>

<output>
After completion, create `.planning/phases/42-subpath-exports/42-01-SUMMARY.md`
</output>
