---
phase: 43-import-rewrite
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - src/runtime/index.ts
  - src/runtime/runner.ts
  - src/ai/index.ts
  - src/ai/types.ts
  - src/ai/mcts-bot.ts
  - src/ai/mcts-bot.test.ts
  - src/ai/mcts-cache.test.ts
  - src/ai/cribbage-bot.test.ts
  - src/testing/index.ts
  - src/testing/assertions.ts
  - src/testing/debug.ts
  - src/testing/fixtures.ts
  - src/testing/random-simulation.ts
  - src/testing/simulate-action.ts
  - src/testing/test-game.ts
  - src/ai-trainer/types.ts
  - src/ai-trainer/introspector.ts
  - src/ai-trainer/feature-templates.ts
  - src/ai-trainer/weight-evolver.ts
  - src/ai-trainer/simulator.ts
  - src/ai-trainer/parallel-simulator.ts
  - src/ai-trainer/parallel-trainer.ts
  - src/ai-trainer/simulation-worker.ts
  - src/ai-trainer/benchmark.ts
  - src/ai-trainer/benchmark-worker.ts
  - src/session/types.ts
  - src/session/index.ts
  - src/session/colors.ts
  - src/session/utils.ts
  - src/session/state-history.ts
  - src/session/checkpoint-manager.ts
  - src/session/pending-action-manager.ts
  - src/session/selection-handler.ts
  - src/session/debug-controller.ts
  - src/session/ai-controller.ts
  - src/session/game-session.ts
autonomous: true

must_haves:
  truths:
    - "All @boardsmith/engine imports in foundation layers use relative paths"
    - "All @boardsmith/runtime imports use ../runtime/index.js"
    - "All @boardsmith/ai imports use ../ai/index.js"
    - "TypeScript compilation succeeds with 0 errors"
  artifacts:
    - path: "src/runtime/index.ts"
      provides: "Relative imports to engine"
      contains: "../engine/index.js"
    - path: "src/ai/index.ts"
      provides: "Relative imports to engine"
      contains: "../engine/index.js"
    - path: "src/session/game-session.ts"
      provides: "Relative imports to engine, runtime, ai"
      contains: "../engine/index.js"
  key_links:
    - from: "src/session/game-session.ts"
      to: "../engine/index.js"
      via: "relative import"
      pattern: "from ['\"]\\.\\./"
---

<objective>
Rewrite @boardsmith/* imports in foundation and middle layers to relative paths

Purpose: Phase 43 replaces all workspace package imports with relative paths. This plan handles the core dependency chain: runtime, ai, testing, ai-trainer, and session modules. These modules form the foundation that peripheral modules depend on.

Output: 36 files with rewritten imports using relative paths with .js extensions
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/43-import-rewrite/43-RESEARCH.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Rewrite foundation layer imports (runtime, ai, testing)</name>
  <files>
    src/runtime/index.ts
    src/runtime/runner.ts
    src/ai/index.ts
    src/ai/types.ts
    src/ai/mcts-bot.ts
    src/ai/mcts-bot.test.ts
    src/ai/mcts-cache.test.ts
    src/ai/cribbage-bot.test.ts
    src/testing/index.ts
    src/testing/assertions.ts
    src/testing/debug.ts
    src/testing/fixtures.ts
    src/testing/random-simulation.ts
    src/testing/simulate-action.ts
    src/testing/test-game.ts
  </files>
  <action>
    Rewrite all `@boardsmith/*` imports to relative paths in the foundation layer modules.

    **Mapping (from RESEARCH.md):**
    - `@boardsmith/engine` -> `../engine/index.js`
    - `@boardsmith/runtime` -> `../runtime/index.js`

    **Rules:**
    1. All relative imports MUST end in `.js` (ESM requirement)
    2. Preserve `import type` vs `import` distinction
    3. Do NOT modify JSDoc examples or comments containing `@boardsmith/`

    **src/runtime/ (4 occurrences in 2 files):**
    - index.ts: 3 re-exports from @boardsmith/engine
    - runner.ts: 1 import from @boardsmith/engine

    **src/ai/ (7 occurrences in 6 files):**
    - index.ts: 1 re-export from @boardsmith/engine
    - types.ts: 1 import from @boardsmith/engine
    - mcts-bot.ts: 2 imports from @boardsmith/engine
    - Test files: imports from @boardsmith/engine and @boardsmith/testing

    **src/testing/ (10 occurrences in 7 files):**
    - All files import from @boardsmith/engine
    - simulate-action.ts, test-game.ts also import from @boardsmith/runtime
  </action>
  <verify>
    Run `npx tsc --noEmit` - should complete without errors for these files.
    Run `grep -r "@boardsmith/" src/runtime src/ai src/testing | grep "from '"` - should return only test imports of game packages.
  </verify>
  <done>
    All 15 foundation layer files use relative imports. No @boardsmith/engine, @boardsmith/runtime references remain in src/runtime/, src/ai/, or src/testing/.
  </done>
</task>

<task type="auto">
  <name>Task 2: Rewrite ai-trainer and session imports</name>
  <files>
    src/ai-trainer/types.ts
    src/ai-trainer/introspector.ts
    src/ai-trainer/feature-templates.ts
    src/ai-trainer/weight-evolver.ts
    src/ai-trainer/simulator.ts
    src/ai-trainer/parallel-simulator.ts
    src/ai-trainer/parallel-trainer.ts
    src/ai-trainer/simulation-worker.ts
    src/ai-trainer/benchmark.ts
    src/ai-trainer/benchmark-worker.ts
    src/session/types.ts
    src/session/index.ts
    src/session/colors.ts
    src/session/utils.ts
    src/session/state-history.ts
    src/session/checkpoint-manager.ts
    src/session/pending-action-manager.ts
    src/session/selection-handler.ts
    src/session/debug-controller.ts
    src/session/ai-controller.ts
    src/session/game-session.ts
  </files>
  <action>
    Rewrite all `@boardsmith/*` imports to relative paths in ai-trainer and session modules.

    **Mapping:**
    - `@boardsmith/engine` -> `../engine/index.js`
    - `@boardsmith/runtime` -> `../runtime/index.js`
    - `@boardsmith/ai` -> `../ai/index.js`

    **Rules:**
    1. All relative imports MUST end in `.js` (ESM requirement)
    2. Preserve `import type` vs `import` distinction
    3. SKIP src/ai-trainer/code-generator.ts - it generates code for external projects

    **src/ai-trainer/ (14 occurrences in 10 files - skip code-generator.ts):**
    - types.ts: @boardsmith/engine
    - introspector.ts: @boardsmith/engine
    - feature-templates.ts: @boardsmith/engine
    - weight-evolver.ts: @boardsmith/engine
    - simulator.ts: @boardsmith/engine, @boardsmith/runtime, @boardsmith/ai
    - parallel-simulator.ts: @boardsmith/engine
    - parallel-trainer.ts: @boardsmith/engine
    - simulation-worker.ts: @boardsmith/engine
    - benchmark.ts: @boardsmith/engine, @boardsmith/runtime, @boardsmith/ai
    - benchmark-worker.ts: @boardsmith/engine

    **src/session/ (29 occurrences in 11 files):**
    - types.ts: @boardsmith/engine, @boardsmith/ai (5 imports)
    - index.ts: @boardsmith/engine (1 re-export)
    - colors.ts: @boardsmith/engine (2 imports)
    - utils.ts: @boardsmith/engine, @boardsmith/runtime (2 imports)
    - state-history.ts: @boardsmith/engine, @boardsmith/runtime (2 imports)
    - checkpoint-manager.ts: @boardsmith/engine (2 imports)
    - pending-action-manager.ts: @boardsmith/engine, @boardsmith/runtime (2 imports)
    - selection-handler.ts: @boardsmith/engine, @boardsmith/runtime (2 imports)
    - debug-controller.ts: @boardsmith/engine, @boardsmith/runtime (3 imports)
    - ai-controller.ts: @boardsmith/engine, @boardsmith/runtime, @boardsmith/ai (4 imports)
    - game-session.ts: @boardsmith/engine, @boardsmith/runtime, @boardsmith/ai (4 imports)
  </action>
  <verify>
    Run `npx tsc --noEmit` - should complete without errors.
    Run `grep -r "@boardsmith/" src/ai-trainer src/session | grep "from '" | grep -v code-generator` - should return empty.
  </verify>
  <done>
    All 21 ai-trainer and session files use relative imports (excluding code-generator.ts which generates external code). TypeScript compiles successfully.
  </done>
</task>

</tasks>

<verification>
After both tasks complete:

1. **TypeScript compilation:**
   ```bash
   npx tsc --noEmit
   ```
   Must complete with 0 errors.

2. **Verify no @boardsmith/ imports remain in rewritten modules:**
   ```bash
   grep -r "from '@boardsmith/" src/runtime src/ai src/testing src/ai-trainer src/session | grep -v code-generator | grep -v ".test.ts.*@boardsmith/.*-rules"
   ```
   Should return empty (only game package test imports allowed).

3. **Spot check relative path format:**
   ```bash
   grep -r "../engine/index.js" src/runtime src/ai src/testing src/ai-trainer src/session | head -5
   ```
   Should show multiple hits with correct .js extension.
</verification>

<success_criteria>
- [ ] 36 files have @boardsmith/* imports rewritten to relative paths
- [ ] All relative imports use .js extension
- [ ] code-generator.ts preserved (generates external code)
- [ ] TypeScript compiles with 0 errors
- [ ] No @boardsmith/engine, @boardsmith/runtime, @boardsmith/ai imports remain in modified modules
</success_criteria>

<output>
After completion, create `.planning/phases/43-import-rewrite/43-01-SUMMARY.md`
</output>
