---
phase: 45-cli-update
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - src/cli/commands/init.ts
  - src/cli/lib/project-scaffold.ts
autonomous: true
user_setup: []

must_haves:
  truths:
    - "boardsmith init creates projects with 'boardsmith' imports (not @boardsmith/*)"
    - "Generated package.json has boardsmith as a dependency (not @boardsmith/engine)"
    - "Generated App.vue imports from 'boardsmith/ui' (not @boardsmith/ui)"
    - "Generated test file imports from 'boardsmith/testing'"
    - "Generated project runs npm install without errors"
  artifacts:
    - path: "src/cli/commands/init.ts"
      provides: "Init command with updated template functions"
      contains: "from 'boardsmith'"
    - path: "src/cli/lib/project-scaffold.ts"
      provides: "Scaffold generators with correct dependency paths"
      contains: "boardsmith"
  key_links:
    - from: "src/cli/commands/init.ts"
      to: "src/cli/lib/project-scaffold.ts"
      via: "generateScaffoldFiles import"
      pattern: "import.*project-scaffold"
---

<objective>
Update the `boardsmith init` command to generate standalone game projects that use the new `boardsmith` package with subpath exports.

Purpose: New projects created with `boardsmith init` must use `boardsmith` imports, not the old `@boardsmith/*` package names. This is required for CLI-01.

Output: Updated init.ts and project-scaffold.ts that generate correct standalone projects.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/45-cli-update/45-RESEARCH.md
@/private/tmp/boardsmith-test-target/EXTRACTION-GUIDE.md
@/private/tmp/boardsmith-test-target/hex/package.json
</context>

<tasks>

<task type="auto">
  <name>Task 1: Update project-scaffold.ts for standalone projects</name>
  <files>src/cli/lib/project-scaffold.ts</files>
  <action>
Update project-scaffold.ts to generate projects that depend on `boardsmith` instead of `@boardsmith/*`:

1. **Update getMonorepoRoot()**: This function currently checks for `packages/engine/package.json` which no longer exists in the collapsed structure. Update to check for the existence of `src/engine/` directory instead (the collapsed source structure).

2. **Update getDependencyPaths()**: Change from returning separate engine/ui/cli/testing paths to returning a single `boardsmith` path:
   - If in monorepo (local dev): return `{ boardsmith: 'file:' + path.resolve(monorepoRoot), isLocalDev: true }`
   - If not: return `{ boardsmith: '^0.0.1', isLocalDev: false }`
   - Remove the separate engine/ui/cli/testing properties as they're no longer needed

3. **Update generatePackageJson()**:
   - Change package name from `@mygames/${config.name}` to just `${config.name}`
   - Replace dependencies section to use:
     ```
     dependencies: {
       boardsmith: deps.boardsmith,
       vue: '^3.4.0',
     }
     ```
   - Remove `@boardsmith/cli` from devDependencies (use `npx boardsmith` instead)
   - Remove `@boardsmith/testing` from devDependencies (it's a subpath of boardsmith)
   - Keep vitest, typescript, @vitejs/plugin-vue as devDependencies

4. **Update generateAppVue()**: Change import from `@boardsmith/ui` to `boardsmith/ui`:
   ```typescript
   import { GameShell, AutoUI } from 'boardsmith/ui';
   ```

5. **Update generateRulesIndexTs()**: No changes needed (doesn't import @boardsmith/*)
  </action>
  <verify>
grep -E "@boardsmith/" src/cli/lib/project-scaffold.ts | wc -l
# Should output 0 (no @boardsmith/* imports in generated code)
  </verify>
  <done>project-scaffold.ts generates code using 'boardsmith' and 'boardsmith/ui' imports, with single boardsmith dependency</done>
</task>

<task type="auto">
  <name>Task 2: Update init.ts template functions</name>
  <files>src/cli/commands/init.ts</files>
  <action>
Update init.ts to generate game files with `boardsmith` imports:

1. **Update generateGameTs()**:
   - Change `import { Game, Player, type GameOptions } from '@boardsmith/engine';`
   - To: `import { Game, Player, type GameOptions } from 'boardsmith';`

2. **Update generateElementsTs()**:
   - Change `import { Card as BaseCard, Hand as BaseHand, Deck as BaseDeck, Space } from '@boardsmith/engine';`
   - To: `import { Card as BaseCard, Hand as BaseHand, Deck as BaseDeck, Space } from 'boardsmith';`

3. **Update generateActionsTs()**:
   - Change `import { Action, type ActionDefinition } from '@boardsmith/engine';`
   - To: `import { Action, type ActionDefinition } from 'boardsmith';`

4. **Update generateFlowTs()**:
   - Change `import { loop, eachPlayer, actionStep, sequence, type FlowDefinition } from '@boardsmith/engine';`
   - To: `import { loop, eachPlayer, actionStep, sequence, type FlowDefinition } from 'boardsmith';`

5. **Update generateTestTs()**:
   - Add import for Player at the top (currently missing, causing test to fail):
     ```typescript
     import { describe, it, expect } from 'vitest';
     import { Player } from 'boardsmith';
     import { ${pascal}Game } from '../src/rules/game.js';
     ```
   - Note: The test references `Player` class but doesn't import it

6. **Update console output**: Change "Using local packages from monorepo" to "Using local BoardSmith from monorepo" for clarity
  </action>
  <verify>
grep -E "@boardsmith/" src/cli/commands/init.ts | wc -l
# Should output 0 (no @boardsmith/* imports in generated template strings)
  </verify>
  <done>init.ts generates all game files with 'boardsmith' imports instead of '@boardsmith/*'</done>
</task>

<task type="auto">
  <name>Task 3: Verify init command end-to-end</name>
  <files></files>
  <action>
Test the updated init command by creating a new project and verifying it works:

1. Build the CLI to pick up changes:
   ```bash
   cd /Users/jtsmith/board_game_service/BoardSmith
   npm run build
   ```

2. Create a test project in /tmp:
   ```bash
   cd /tmp
   rm -rf test-init-game
   npx /Users/jtsmith/board_game_service/BoardSmith/dist/cli/cli.js init test-init-game
   ```

3. Verify generated files have correct imports:
   ```bash
   cd /tmp/test-init-game
   grep -r "@boardsmith/" src/ tests/
   # Should return nothing (no @boardsmith/* imports)

   grep "from 'boardsmith'" src/rules/*.ts
   # Should show multiple matches

   grep "from 'boardsmith/ui'" src/ui/App.vue
   # Should show match
   ```

4. Verify package.json structure:
   ```bash
   cat package.json | grep -A 5 '"dependencies"'
   # Should show: "boardsmith": "..." (file: link or version)
   # Should NOT show any @boardsmith/* packages
   ```

5. Install dependencies and verify it works:
   ```bash
   npm install
   ```

6. Clean up:
   ```bash
   cd /tmp
   rm -rf test-init-game
   ```
  </action>
  <verify>
# Run the commands above - no @boardsmith/* imports should exist in generated project
# npm install should complete without errors
  </verify>
  <done>boardsmith init creates a working standalone project with correct boardsmith imports and dependencies</done>
</task>

</tasks>

<verification>
Run init command and verify generated project:

```bash
# Build CLI
cd /Users/jtsmith/board_game_service/BoardSmith && npm run build

# Create test project
cd /tmp && rm -rf test-init-verify && npx /Users/jtsmith/board_game_service/BoardSmith/dist/cli/cli.js init test-init-verify

# Verify no @boardsmith/* imports
cd /tmp/test-init-verify && grep -r "@boardsmith/" src/ tests/ && echo "FAIL: Found @boardsmith imports" || echo "PASS: No @boardsmith imports"

# Verify boardsmith imports exist
grep "from 'boardsmith'" src/rules/*.ts | head -3
grep "from 'boardsmith/ui'" src/ui/App.vue

# Verify package.json
grep "boardsmith" package.json

# Install and verify
npm install

# Cleanup
cd /tmp && rm -rf test-init-verify
```
</verification>

<success_criteria>
- [ ] No `@boardsmith/*` imports in generated template code
- [ ] package.json uses `boardsmith` as main dependency
- [ ] App.vue imports from `boardsmith/ui`
- [ ] Test file imports from `boardsmith` and `boardsmith/testing`
- [ ] `npm install` succeeds in generated project
- [ ] All TypeScript files compile without import errors
</success_criteria>

<output>
After completion, create `.planning/phases/45-cli-update/45-01-SUMMARY.md`
</output>
