---
phase: 48-continuation-flow
plan: 02
type: execute
wave: 2
depends_on: ["48-01"]
files_modified:
  - src/cli/slash-command/instructions.md
autonomous: true
user_setup: []

must_haves:
  truths:
    - "/design-game shows deferred ideas ranked by urgency as 'what's next?' options"
    - "Designer can choose any option including new ideas from feedback"
    - "Chosen feature gets a mini-interview using ACDR pattern"
    - "Feature implementation includes both rules and basic UI"
    - "HISTORY.md is created/updated after each phase completion"
  artifacts:
    - path: "src/cli/slash-command/instructions.md"
      provides: "Feature selection, interview, generation, and state update sections"
      contains: "## Phase 10: Present Next Options"
  key_links:
    - from: "instructions.md Phase 9"
      to: "instructions.md Phase 10"
      via: "Continuation after feedback"
      pattern: "proceed to Phase 10"
    - from: "instructions.md Phase 12"
      to: "HISTORY.md template"
      via: "State file updates"
      pattern: "Create or update HISTORY.md"
---

<objective>
Add feature selection, mini-interview, code generation, and state management to /design-game instructions

Purpose: Complete the continuation flow by enabling designers to select their next feature, conduct a focused interview, generate working code (rules + UI), and maintain design history. This implements the second half of the "return after playtesting" journey.

Output: Updated instructions.md with Phases 10-14 covering option presentation through playtest prompt for next iteration
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/48-continuation-flow/48-RESEARCH.md
@.planning/phases/48-continuation-flow/48-CONTEXT.md
@.planning/phases/48-continuation-flow/48-01-SUMMARY.md
@src/cli/slash-command/instructions.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add Phase 10 - Present Next Options</name>
  <files>src/cli/slash-command/instructions.md</files>
  <action>
Add "## Phase 10: Present Next Options" section after Phase 9.

Content should cover:
1. Ranking logic (from RESEARCH.md):
   - Needs Fix items (from Phase 9 feedback) - highest priority
   - Deferred Ideas from PROJECT.md (already captured)
   - New Ideas from feedback (not already in backlog)
2. Display format: "## What's Next?" with numbered options
3. Recommendation pattern: "I suggest fixing X first since it affects core gameplay, but you can pick anything."
4. New Ideas handling: If not chosen, add to PROJECT.md Deferred Ideas section
5. Empty backlog handling: If all Deferred Ideas done, prompt "Your backlog is empty. What would you like to add next?"

Include example display showing recommended fix item + backlog items.
  </action>
  <verify>grep "Phase 10: Present Next Options" src/cli/slash-command/instructions.md returns content</verify>
  <done>Phase 10 section exists with ranked options, recommendation pattern, and empty backlog handling</done>
</task>

<task type="auto">
  <name>Task 2: Add Phase 11 - Feature Mini-Interview</name>
  <files>src/cli/slash-command/instructions.md</files>
  <action>
Add "## Phase 11: Feature Mini-Interview" section after Phase 10.

Content should cover:
1. Purpose: Gather specifics for the chosen feature before implementing
2. Question structure: Ask 2-4 focused questions about:
   - Who/What is involved
   - When does it happen
   - What are the constraints
3. ACDR governor pattern (already established in Phase 3) applied to feature scope:
   - Capture edge cases as "captured for later"
   - Implement core only
4. Confirmation pattern: Present what will be implemented vs what was deferred, ask for approval
5. Scope limit: More than 3-4 requirements = too much, capture extras for later

Include example dialogue for "Card Trading" feature mini-interview.
  </action>
  <verify>grep "Phase 11: Feature Mini-Interview" src/cli/slash-command/instructions.md returns content</verify>
  <done>Phase 11 section exists with focused questions, ACDR application, and confirmation pattern</done>
</task>

<task type="auto">
  <name>Task 3: Add Phase 12 - Generate Feature Code</name>
  <files>src/cli/slash-command/instructions.md</files>
  <action>
Add "## Phase 12: Generate Feature Code" section after Phase 11.

Content should cover:
1. Dual requirement: Every feature needs BOTH rules AND UI
   - Rules: Update elements.ts, game.ts, actions.ts, flow.ts as needed
   - UI: Create/update Vue component for the feature
2. UI scope for "basic" implementation:
   - Functional controls (buttons, selectors)
   - Clear visual feedback (highlights, states)
   - No animations or polish (deferred)
3. Action-UI wiring: Use useBoardInteraction composable (standard BoardSmith pattern)
4. Verification: Run `npx tsc --noEmit` after generation
5. Common generation patterns:
   - New action: Create function in actions.ts, register in game.ts constructor
   - New element property: Add to element class, update any queries
   - New UI: Create .vue file in src/ui/, wire to action via useBoardInteraction

Reference the Quick Reference section for action DSL and flow primitives.
  </action>
  <verify>grep "Phase 12: Generate Feature Code" src/cli/slash-command/instructions.md returns content</verify>
  <done>Phase 12 section exists with rules+UI requirement, basic UI scope definition, and common patterns</done>
</task>

<task type="auto">
  <name>Task 4: Add Phase 13 - Update State Files</name>
  <files>src/cli/slash-command/instructions.md</files>
  <action>
Add "## Phase 13: Update State Files" section after Phase 12.

Content should cover:
1. STATE.md updates:
   - Increment phase number (e.g., Phase 1 -> Phase 2)
   - Update phase name to feature name (e.g., "Phase 2 - Card Trading")
   - Reset progress checkboxes for new phase
   - Set Status back to "In Progress" -> then "Complete" after verification
2. PROJECT.md updates:
   - Check off implemented Deferred Idea: `- [x] Feature name (Phase N)`
   - Add new deferred items captured during mini-interview
3. HISTORY.md creation/update (NEW - ART-04):
   - Create if doesn't exist
   - Append phase summary after each phase completes
   - Template structure: Phase number, completed date, what was built (3-5 bullets), playtest feedback, deferred items

Include the HISTORY.md template from RESEARCH.md.
  </action>
  <verify>grep "Phase 13: Update State Files" src/cli/slash-command/instructions.md returns content && grep "HISTORY.md" src/cli/slash-command/instructions.md</verify>
  <done>Phase 13 section exists with STATE.md, PROJECT.md, and HISTORY.md update patterns including template</done>
</task>

<task type="auto">
  <name>Task 5: Add Phase 14 - Iteration Playtest Prompt</name>
  <files>src/cli/slash-command/instructions.md</files>
  <action>
Add "## Phase 14: Iteration Playtest Prompt" section after Phase 13.

Content should cover:
1. Summary display: Show what was built in this iteration
2. How to test: Remind designer to run `boardsmith dev`
3. Next steps: "When ready to continue, run `/design-game` again"
4. Remaining backlog preview: Show count of remaining Deferred Ideas

This is similar to Phase 7 (initial playtest prompt) but for iterations.

Also update the Critical Rules section at the end to add:
- "Every feature needs rules AND UI" (from Phase 12)
- "Keep HISTORY.md entries brief (3-5 bullets per phase)"
  </action>
  <verify>grep "Phase 14: Iteration Playtest Prompt" src/cli/slash-command/instructions.md returns content</verify>
  <done>Phase 14 section exists with iteration summary and Critical Rules updated</done>
</task>

</tasks>

<verification>
1. instructions.md has continuous phase numbering (1-14)
2. Phase 9 -> Phase 10 transition documented
3. Phase 10 presents ranked options from feedback and backlog
4. Phase 11 conducts mini-interview with ACDR
5. Phase 12 generates both rules and UI
6. Phase 13 updates all three state files (STATE.md, PROJECT.md, HISTORY.md)
7. Phase 14 prompts for next playtest iteration
8. HISTORY.md template included
9. Critical Rules updated with new patterns
</verification>

<success_criteria>
- CON-03 implemented: Phase 10 shows "what's next?" with deferred ideas
- CON-04 implemented: Phases 10-12 plan and execute single feature
- ART-04 implemented: Phase 13 includes HISTORY.md template
- Full iteration loop: Designer can return, give feedback, pick feature, implement, playtest, repeat
</success_criteria>

<output>
After completion, create `.planning/phases/48-continuation-flow/48-02-SUMMARY.md`
</output>
