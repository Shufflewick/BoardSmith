---
phase: 49-session-continuity
plan: 01
type: execute
wave: 1
depends_on: []
files_modified: [src/cli/slash-command/instructions.md]
autonomous: true

must_haves:
  truths:
    - "Designer returning mid-session sees context of what was in progress"
    - "Resume continues from the correct checkpoint based on Progress checkboxes"
    - "Errors during resume trigger graceful recovery without interrogating designer"
    - "Phase 1 State Detection routes to Resume Flow for 'In Progress' status"
  artifacts:
    - path: "src/cli/slash-command/instructions.md"
      provides: "Phase 15: Resume Flow section"
      contains: "## Phase 15: Resume Flow"
  key_links:
    - from: "Phase 1: State Detection"
      to: "Phase 15: Resume Flow"
      via: "Status: 'In Progress' routing"
      pattern: "Proceed to Phase 15"
    - from: "Phase 15: Resume Flow"
      to: "Phase 2/5/6/7/10/11/12"
      via: "Checkpoint-based resume point detection"
      pattern: "Resume at Phase"
---

<objective>
Add Phase 15: Resume Flow to instructions.md to handle mid-session interruptions

Purpose: Designers returning mid-phase should see where they left off and continue smoothly without re-doing completed work or being interrogated about state
Output: Updated instructions.md with complete session continuity support
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/49-session-continuity/49-RESEARCH.md
@src/cli/slash-command/instructions.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add Phase 15 - Resume Flow</name>
  <files>src/cli/slash-command/instructions.md</files>
  <action>
Add a new "## Phase 15: Resume Flow" section after Phase 14 and before Critical Rules.

The section must include:

**Step 1: Display Context**
- "Picking up where we left off..." header
- Show: Phase name (not just number), Last Action from STATE.md
- Show: Done items (checked Progress checkboxes)
- Show: Remaining items (unchecked Progress checkboxes)
- End with "Continuing with X..." to set expectations

**Step 2: Determine Resume Point**
- Find first unchecked [ ] in Progress section
- For Phase 1 (Initial Generation) checkpoints:
  - Interview complete -> Resume at Phase 2
  - PROJECT.md created -> Resume at Phase 4
  - Code generated -> Resume at Phase 5
  - Code compiles -> Resume at Phase 6
  - Ready for playtest -> Resume at Phase 7
- For Phase N (Feature Iteration) checkpoints:
  - Feature selected -> Resume at Phase 10
  - Mini-interview complete -> Resume at Phase 11
  - Rules/UI implemented -> Resume at Phase 12
  - Code compiles -> Resume at Phase 12 verification
  - Ready for playtest -> Resume at Phase 14

**Step 3: Validate Prior Checkpoints**
- Before resuming, verify all checked [x] items are actually done
- FILES: Do expected files exist?
- COMPILE: Does `npx tsc --noEmit` pass?
- If validation fails: Use silent repair protocol (from Phase 8), limit to 2-3 attempts, then backtrack if still failing

**Step 4: Error Recovery Hierarchy**
Three levels:
1. Recoverable (tsc fails, missing import): Silent repair, continue
2. Corrupt State (Progress claims X but artifact missing): Backtrack to valid checkpoint with explanation
3. Unrecoverable (STATE.md malformed): Display error with recovery options (show PROJECT.md or start fresh)

Include example displays for:
- Normal resume context
- Recoverable error ("Let me fix that first...")
- Corrupt state ("I noticed some files are missing...")
- Unrecoverable error ("I couldn't understand your design state...")

Use the same formatting style as other Phase sections (markdown headers, code blocks for examples, clear step numbering).
  </action>
  <verify>grep -q "## Phase 15: Resume Flow" src/cli/slash-command/instructions.md</verify>
  <done>Phase 15 section exists with all four steps: context display, resume point detection, checkpoint validation, error recovery</done>
</task>

<task type="auto">
  <name>Task 2: Wire Phase 1 State Detection to Phase 15</name>
  <files>src/cli/slash-command/instructions.md</files>
  <action>
Update the Phase 1: State Detection section to properly route to Phase 15.

Currently it says:
```
**If status shows "phase in progress":**
- Designer returned mid-session
- Proceed to Resume Flow (covered in Phase 49)
```

Change to:
```
**If status shows "In Progress":**
- Designer returned mid-session
- Proceed to Phase 15: Resume Flow
```

This makes the routing explicit and consistent with other routing patterns ("Proceed to Phase X").

Also verify the status value matches what STATE.md templates use ("In Progress" not "phase in progress").
  </action>
  <verify>grep -q "Proceed to Phase 15: Resume Flow" src/cli/slash-command/instructions.md</verify>
  <done>Phase 1 explicitly routes "In Progress" status to Phase 15</done>
</task>

<task type="auto">
  <name>Task 3: Add Resume Flow to Critical Rules</name>
  <files>src/cli/slash-command/instructions.md</files>
  <action>
Add a rule about resume behavior to the Critical Rules section at the end of the document.

Add:
```
8. **Resume without interrogation** - Don't ask designer where they were; detect from STATE.md and proceed
```

This codifies the key principle from the research that distinguishes good UX from bad.
  </action>
  <verify>grep -q "Resume without interrogation" src/cli/slash-command/instructions.md</verify>
  <done>Critical Rules includes resume principle (8 rules total)</done>
</task>

</tasks>

<verification>
1. Phase 15 section exists between Phase 14 and Critical Rules
2. Phase 1 routes "In Progress" to Phase 15 explicitly
3. Critical Rules now has 8 items including resume principle
4. All checkpoint mappings documented for both Phase 1 and Phase N
5. Error recovery hierarchy documented with examples
</verification>

<success_criteria>
- STATE-03: Phase 1 detects "In Progress" status and routes to Phase 15
- RES-01: Phase 15 Step 2 maps checkboxes to resume phases
- RES-02: Phase 15 Step 1 shows progress context
- RES-03: Phase 15 Steps 3-4 handle errors gracefully
</success_criteria>

<output>
After completion, create `.planning/phases/49-session-continuity/49-01-SUMMARY.md`
</output>
