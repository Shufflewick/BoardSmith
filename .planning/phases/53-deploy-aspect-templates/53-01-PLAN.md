---
phase: 53-deploy-aspect-templates
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - src/cli/slash-command/instructions.md
  - .planning/phases/52-detection-and-integration/52-01-PLAN.md
autonomous: true
gap_closure: true

must_haves:
  truths:
    - "Aspect template content is inline in instructions.md"
    - "No external file reads required when using slash command"
    - "Fresh install includes all aspect template content"
    - "E2E flow works: Interview to Detection to Template Access to Generation"
  artifacts:
    - path: "src/cli/slash-command/instructions.md"
      provides: "Complete slash command with embedded aspect templates"
      contains: "## Dice Aspect Template"
    - path: ".planning/phases/52-detection-and-integration/52-01-PLAN.md"
      provides: "Phase 52 plan with completion marks"
      contains: "[x]"
  key_links:
    - from: "instructions.md Phase 2B"
      to: "instructions.md Aspect Templates section"
      via: "inline reference (no file read)"
      pattern: "See the .* Aspect Template section below"
    - from: "instructions.md Phase 5 Step 3"
      to: "instructions.md Aspect Templates section"
      via: "inline reference (no file read)"
      pattern: "Read the .* section below"
---

<objective>
Embed aspect template content directly into instructions.md so the slash command is fully self-contained.

Purpose: The aspect template files exist in source but are not deployed with the installed slash command. Claude cannot read external files at runtime, causing the E2E flow to break at template access.

Output: A single instructions.md file containing all aspect templates inline, with updated references pointing to inline sections instead of external files.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/STATE.md
@.planning/v2.2-MILESTONE-AUDIT.md
@src/cli/slash-command/instructions.md
@src/cli/slash-command/aspects/dice.md
@src/cli/slash-command/aspects/playing-cards.md
@src/cli/slash-command/aspects/hex-grid.md
@src/cli/slash-command/aspects/square-grid.md
@src/cli/slash-command/aspects/index.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Embed aspect templates into instructions.md</name>
  <files>src/cli/slash-command/instructions.md</files>
  <action>
Add a new major section "## Aspect Templates" after the existing "Phase 5: Generate Initial Code" section (before Phase 6). This section contains the full content of each aspect template file:

1. Add section header: `## Aspect Templates`

2. Add subsection intro explaining these are inline templates:
   ```
   The following templates provide patterns for each aspect type. When an aspect is detected in Phase 2B, use the corresponding template below to generate code.
   ```

3. Embed each template as a subsection:
   - `### Dice Aspect Template` - Full content from aspects/dice.md
   - `### Playing Cards Aspect Template` - Full content from aspects/playing-cards.md
   - `### Hex Grid Aspect Template` - Full content from aspects/hex-grid.md
   - `### Square Grid Aspect Template` - Full content from aspects/square-grid.md

4. Preserve all code blocks, key rules, and documentation links from each template.

5. Update Phase 2B "Available Aspects" table to sync keywords with index.md:
   - Dice: Add "rolling" keyword
   - PlayingCards: Add "trump, discard" keywords
   - HexGrid: Add "hexes, hexagonal" keywords
   - SquareGrid: Add "tiles" keyword

6. Update Phase 5 "Step 3: Read Aspect Templates" to reference inline sections instead of external files:
   - Change "read the corresponding template file from this skill's `aspects/` folder" to "see the corresponding Aspect Template section below"
   - Update the table to reference inline sections:
     | Aspect | Template Section |
     |--------|-----------------|
     | Dice | Dice Aspect Template below |
     | PlayingCards | Playing Cards Aspect Template below |
     | HexGrid | Hex Grid Aspect Template below |
     | SquareGrid | Square Grid Aspect Template below |
   - Change instruction text from "Read these templates now" to "See these template sections below"
  </action>
  <verify>
    - Grep for "## Aspect Templates" in instructions.md
    - Grep for "### Dice Aspect Template" in instructions.md
    - Verify keyword "rolling" appears in Phase 2B table
    - Verify "aspects/" folder reference is removed from Phase 5 Step 3
  </verify>
  <done>
    - instructions.md contains all 4 aspect templates inline
    - Phase 2B keywords synced with index.md (includes rolling, trump, discard, hexes, hexagonal, tiles)
    - Phase 5 Step 3 references inline sections instead of external files
    - No references to reading from aspects/ folder remain
  </done>
</task>

<task type="auto">
  <name>Task 2: Update 52-01-PLAN.md completion marks (tech debt)</name>
  <files>.planning/phases/52-detection-and-integration/52-01-PLAN.md</files>
  <action>
Update 52-01-PLAN.md to reflect actual completion status. The audit found all tasks and success criteria marked as unchecked despite the work being complete.

Change all `[ ]` to `[x]` for:

Tasks section:
1. [x] Create aspect index file listing available aspects and their keywords
2. [x] Add "Aspect Detection" section after Phase 2 interview in instructions.md
3. [x] Define keyword detection rules for each aspect
4. [x] Add aspect detection step to Phase 4 (Create Artifacts)
5. [x] Store detected aspects in PROJECT.md
6. [x] Update Phase 5 (Generate Initial Code) to read/merge aspects
7. [x] Test each aspect individually
8. [x] Test aspect combinations
9. [x] Test no-aspect baseline

Success Criteria section:
- [x] Aspects detected from interview keywords
- [x] Detected aspects listed in PROJECT.md
- [x] Generated code includes aspect-specific elements
- [x] Generated UI includes aspect-specific components
- [x] Games with no detected aspects still work
  </action>
  <verify>
    - Grep for `\[ \]` in 52-01-PLAN.md should return no matches
    - Grep for `\[x\]` in 52-01-PLAN.md should return 14 matches (9 tasks + 5 criteria)
  </verify>
  <done>
    - All 9 tasks marked complete with [x]
    - All 5 success criteria marked complete with [x]
    - Tech debt item resolved
  </done>
</task>

<task type="auto">
  <name>Task 3: Verify E2E flow works</name>
  <files>src/cli/slash-command/instructions.md</files>
  <action>
Verify the updated instructions.md supports the complete E2E flow by checking:

1. Phase 2B (Aspect Detection):
   - Keyword table exists with all keywords from index.md
   - Detection process documented
   - Example detection shown

2. Phase 5 Step 3:
   - References inline Aspect Template sections (not external files)
   - Table maps aspects to inline sections
   - Merge instructions for multiple aspects

3. Aspect Template sections:
   - All 4 templates present with complete code
   - Element Setup (game.ts)
   - Elements (elements.ts)
   - Action patterns (actions.ts)
   - UI Component (GameBoard.vue)
   - Key Rules

4. No broken references:
   - No `aspects/dice.md` file paths
   - No "read the file" instructions pointing to aspects/
   - All aspect references point to inline sections

Run verification:
```bash
# Should find inline templates
grep -c "### Dice Aspect Template" src/cli/slash-command/instructions.md
grep -c "### Playing Cards Aspect Template" src/cli/slash-command/instructions.md
grep -c "### Hex Grid Aspect Template" src/cli/slash-command/instructions.md
grep -c "### Square Grid Aspect Template" src/cli/slash-command/instructions.md

# Should NOT find external file references
grep -c "aspects/dice.md" src/cli/slash-command/instructions.md || echo "Good: no external dice.md reference"
grep -c "aspects/playing-cards.md" src/cli/slash-command/instructions.md || echo "Good: no external playing-cards.md reference"
```
  </action>
  <verify>
    - All 4 aspect template headers found
    - No external file references to aspects/*.md remain
    - Keyword sync verified (rolling, trump, discard, hexes, hexagonal, tiles present)
  </verify>
  <done>
    - E2E flow verified: Interview -> Detection -> Template Access (inline) -> Generation
    - instructions.md is fully self-contained
    - Fresh install will include all aspect template content
  </done>
</task>

</tasks>

<verification>
After all tasks complete:

1. **Self-containment check:**
   ```bash
   # instructions.md should have increased significantly in size (~900+ lines)
   wc -l src/cli/slash-command/instructions.md
   ```

2. **No external file dependencies:**
   ```bash
   # Should return 0 matches for aspects folder references
   grep -c "aspects/" src/cli/slash-command/instructions.md | grep "^0$" || echo "WARNING: External references remain"
   ```

3. **All templates embedded:**
   ```bash
   # All 4 templates should be present
   grep -E "^### (Dice|Playing Cards|Hex Grid|Square Grid) Aspect Template" src/cli/slash-command/instructions.md | wc -l
   # Expected: 4
   ```

4. **Tech debt resolved:**
   ```bash
   # No unchecked items in 52-01-PLAN.md
   grep -c "\[ \]" .planning/phases/52-detection-and-integration/52-01-PLAN.md
   # Expected: 0
   ```
</verification>

<success_criteria>
- [ ] instructions.md contains inline Dice Aspect Template section
- [ ] instructions.md contains inline Playing Cards Aspect Template section
- [ ] instructions.md contains inline Hex Grid Aspect Template section
- [ ] instructions.md contains inline Square Grid Aspect Template section
- [ ] Phase 2B keywords synced with index.md
- [ ] Phase 5 Step 3 references inline sections, not external files
- [ ] No references to aspects/ folder remain in instructions.md
- [ ] 52-01-PLAN.md tasks marked [x] complete
- [ ] 52-01-PLAN.md success criteria marked [x] complete
- [ ] E2E flow verified working with inline templates
</success_criteria>

<output>
After completion, create `.planning/phases/53-deploy-aspect-templates/53-01-SUMMARY.md`
</output>
