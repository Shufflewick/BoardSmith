---
phase: 56-position-seat-rename
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - src/engine/player/player.ts
  - src/engine/element/game.ts
  - src/engine/element/game-element.ts
  - src/engine/element/piece.ts
  - src/engine/element/hand.ts
  - src/engine/flow/engine.ts
  - src/engine/flow/turn-order.ts
  - src/engine/action/action.ts
  - src/engine/action/helpers.ts
  - src/engine/action/types.ts
  - src/engine/command/types.ts
  - src/engine/command/executor.ts
  - src/engine/command/inverse.ts
  - src/engine/command/visibility.ts
  - src/engine/utils/serializer.ts
  - src/engine/utils/snapshot.ts
autonomous: true

must_haves:
  truths:
    - "Player class has `seat` property instead of `position`"
    - "Game.getPlayer(seat) accepts seat parameter"
    - "player.isFirstPlayer checks seat === 1"
    - "All engine code compiles without errors"
    - "All existing tests pass"
  artifacts:
    - path: "src/engine/player/player.ts"
      provides: "Player.seat property"
      contains: "seat!: number"
    - path: "src/engine/element/game.ts"
      provides: "getPlayer(seat) method"
      contains: "getPlayer(seat: number)"
  key_links:
    - from: "src/engine/element/game.ts"
      to: "src/engine/player/player.ts"
      via: "Player.seat access"
      pattern: "\\.seat"
    - from: "src/engine/utils/serializer.ts"
      to: "src/engine/player/player.ts"
      via: "player.seat serialization"
      pattern: "player\\.seat"
---

<objective>
Rename Player.position to Player.seat in the core engine files.

Purpose: The nomenclature dictionary (Phase 54) established "Seat" as the preferred term for a player's numbered place at the table. This plan updates the core Player class and all engine code that references `player.position`.

Output: Core engine compiles and all tests pass with the new `seat` property name.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/56-position-seat-rename/56-RESEARCH.md
</context>

<critical_exclusions>
DO NOT rename these "position" usages - they are unrelated concepts:

1. **FlowPosition** - Flow engine state path (src/engine/flow/types.ts, state.position)
2. **Piece insertion position** - `putInto({ position: 'first'|'last' })` in piece.ts
3. **CSS position** - `position: absolute/relative` in styles
4. **Queue position** - Matchmaking queue position in client/server
5. **LobbySlot.position** - Will be handled in Plan 02 (session types)

Only rename references that mean "player's seat number at the table".
</critical_exclusions>

<tasks>

<task type="auto">
  <name>Task 1: Rename Player.position to Player.seat</name>
  <files>
    src/engine/player/player.ts
  </files>
  <action>
Rename the `position` property to `seat` on the Player class:

1. Line 104: Change `position!: number;` to `seat!: number;`

2. Update ALL JSDoc references in the file:
   - Line 88: "Seat position (1-indexed..." -> "Seat number (1-indexed..."
   - Line 91: "Use position as a stable identifier..." -> "Use seat as a stable identifier..."
   - Line 101: Example `current.position % playerCount` -> `current.seat % playerCount`
   - Line 115: Example `player.position - 1` -> `player.seat - 1`
   - Line 132: JSDoc "first player (position 1)" -> "first player (seat 1)"

3. Line 145: Change `return this.position === 1;` to `return this.seat === 1;`

4. Update the class docstring at line 17:
   - `{ position: 1 }` -> `{ seat: 1 }`

5. Update line 70: "or use position numbers" -> "or use seat numbers"
  </action>
  <verify>
Run `npx tsc --noEmit` from project root - should show errors in other files that reference `player.position` (expected until they're updated).
  </verify>
  <done>
Player class has `seat!: number` property and `isFirstPlayer` checks `this.seat === 1`.
  </done>
</task>

<task type="auto">
  <name>Task 2: Update Game class player methods</name>
  <files>
    src/engine/element/game.ts
  </files>
  <action>
Update Game class methods that work with player position:

1. **getPlayer method (around line 1713-1740)**:
   - Change parameter name: `getPlayer(position: number)` -> `getPlayer(seat: number)`
   - Update implementation: `(el as any).position` -> `(el as any).seat`
   - Update all JSDoc references to "position" -> "seat"

2. **currentPlayer getter (around line 1683)**:
   - Change `typeof (el as any).position === 'number'` -> `typeof (el as any).seat === 'number'`

3. **getPlayerOrThrow (around line 1753-1774)**:
   - Update parameter name and JSDoc: "position" -> "seat"
   - Update error message: "No player at position" -> "No player at seat"

4. **setCurrentPlayer JSDoc (around line 1787)**:
   - Update references to position -> seat

5. **Player position comparisons throughout**:
   - Line 1858, 1894, 1933, 1965, 2004, 2064, 2072, 2073: Update all `p.position` -> `p.seat`

6. **toJSONForPlayer (around line 140)**:
   - Update parameter name and comments: `playerPosition` -> `playerSeat`

7. **applyPlayerSettings (around line 481)**:
   - Update: `player.position` -> `player.seat`

8. **Line 2285**:
   - Update: `player.position` -> `player.seat`

Search the file for `.position` and update ONLY player-related usages. DO NOT change:
- `command.position` (piece insertion)
- Any flow-related position references
  </action>
  <verify>
Run `npx tsc --noEmit` - errors should decrease as Game class now uses `seat`.
  </verify>
  <done>
Game.getPlayer(seat), getPlayerOrThrow(seat) work with seat parameter. All internal player comparisons use `.seat`.
  </done>
</task>

<task type="auto">
  <name>Task 3: Update remaining engine files</name>
  <files>
    src/engine/element/game-element.ts
    src/engine/element/piece.ts
    src/engine/element/hand.ts
    src/engine/flow/engine.ts
    src/engine/flow/turn-order.ts
    src/engine/action/action.ts
    src/engine/action/helpers.ts
    src/engine/action/types.ts
    src/engine/command/types.ts
    src/engine/command/executor.ts
    src/engine/command/inverse.ts
    src/engine/command/visibility.ts
    src/engine/utils/serializer.ts
    src/engine/utils/snapshot.ts
  </files>
  <action>
Update all remaining engine files that reference player.position:

**game-element.ts:**
- Line 645: `player.position` -> `player.seat`
- Lines 760-761: `__playerRef: player.position` -> `__playerRef: player.seat`, `position: player.position` -> `seat: player.seat`

**piece.ts:**
- Line 187: `player.position` -> `player.seat`
- DO NOT change `position?: 'first' | 'last'` - that's piece insertion position

**hand.ts:**
- Line 17 example: `hand-${player.position}` -> `hand-${player.seat}`

**flow/engine.ts:**
- Line 404: `currentPlayer: this.currentPlayer?.position` -> `currentPlayer: this.currentPlayer?.seat`
- Line 685: `playerIndex: this.currentPlayer?.position` -> `playerIndex: this.currentPlayer?.seat`
- Line 1108: `playerIndex: player.position` -> `playerIndex: player.seat`

**flow/turn-order.ts:**
- Line 108: `player.position` -> `player.seat`
- Line 127 example: `ctx.game.players.nextAfter(dealer).position` -> `ctx.game.players.nextAfter(dealer).seat`

**action/action.ts:**
- Line 1326-1329: `playerPosition` parameter - this is a function parameter name, keep as `playerPosition` for API stability but document it represents the seat

**action/helpers.ts:**
- Lines 153, 160, 165, 169: Update `playerPosition` variable to use `player.seat` instead of `player.position`

**action/types.ts:**
- Line 107: `playerPosition: number` - keep parameter name but update JSDoc to clarify it's the seat number

**command/types.ts:**
- Line 130: `playerPosition: number` - keep parameter name but update JSDoc

**command/executor.ts:**
- Line 193: `command.playerPosition` - no change needed, just ensure it still works

**command/inverse.ts:**
- Line 211: `playerPosition: currentPlayer.position` -> `playerPosition: currentPlayer.seat`

**command/visibility.ts:**
- Lines 31, 35, 40, 49: `playerPosition` parameter - keep parameter name, no changes needed

**serializer.ts:**
- Line 39: `{ __playerRef: player.position }` -> `{ __playerRef: player.seat }`
- Line 131: `player: player.position` -> `player: player.seat`

**snapshot.ts:**
- Line 95, 101-106: `playerPosition` parameter - keep parameter name for API stability
- Line 113: `p.position` -> `p.seat`
- Line 121: `p.position` -> `p.seat`
  </action>
  <verify>
Run `npx tsc --noEmit` from project root - should show NO errors in src/engine/**.
Run `npm test -- --run src/engine` to verify engine tests pass.
  </verify>
  <done>
All engine files updated. `npx tsc --noEmit` shows no errors in src/engine/. Engine tests pass.
  </done>
</task>

</tasks>

<verification>
After all tasks complete:

1. `npx tsc --noEmit` - May still show errors in src/session, src/ui, src/server, src/client (expected - those are updated in later plans)
2. `npm test -- --run src/engine` - All engine tests must pass
3. Grep check: `grep -r "player\.position" src/engine/` should return NO results
4. Grep check: `grep -r "player\.seat" src/engine/` should show the new usage
</verification>

<success_criteria>
- Player class has `seat!: number` property
- `player.isFirstPlayer` checks `this.seat === 1`
- `game.getPlayer(seat)` works with seat parameter
- All engine files use `.seat` for player seat number
- No `player.position` references remain in src/engine/
- All engine tests pass
</success_criteria>

<output>
After completion, create `.planning/phases/56-position-seat-rename/56-01-SUMMARY.md`
</output>
