---
phase: 56-position-seat-rename
plan: 02
type: execute
wave: 2
depends_on: ["56-01"]
files_modified:
  - src/session/types.ts
  - src/session/utils.ts
  - src/session/game-session.ts
  - src/session/state-history.ts
  - src/session/pending-action-manager.ts
  - src/session/selection-handler.ts
  - src/client/types.ts
  - src/server/types.ts
  - src/server/core.ts
  - src/server/handlers/games.ts
  - src/server/handlers/matchmaking.ts
autonomous: true

must_haves:
  truths:
    - "Error codes use SEAT terminology (INVALID_SEAT, SEAT_ALREADY_CLAIMED)"
    - "LobbySlot uses `seat` instead of `position`"
    - "SessionInfo uses `playerSeat` instead of `playerPosition`"
    - "All session/server/client code compiles"
  artifacts:
    - path: "src/session/types.ts"
      provides: "Updated error codes and LobbySlot.seat"
      contains: "INVALID_SEAT"
    - path: "src/client/types.ts"
      provides: "LobbySlot.seat property"
      contains: "seat: number"
  key_links:
    - from: "src/session/game-session.ts"
      to: "src/engine/player/player.ts"
      via: "player.seat access"
      pattern: "\\.seat"
---

<objective>
Update session, client, and server types to use seat terminology.

Purpose: After the core Player.position -> Player.seat rename in Plan 01, this plan updates all session management, client SDK, and server handler code to use consistent "seat" terminology.

Output: All session/client/server code compiles with new seat terminology.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/56-position-seat-rename/56-RESEARCH.md
@.planning/phases/56-position-seat-rename/56-01-SUMMARY.md
</context>

<naming_decision>
For this rename, we'll use these conventions:
- `playerPosition` parameters -> `playerSeat` (except where it would break external APIs)
- `LobbySlot.position` -> `LobbySlot.seat`
- Error codes: `INVALID_POSITION` -> `INVALID_SEAT`, `POSITION_ALREADY_CLAIMED` -> `SEAT_ALREADY_CLAIMED`
- `SessionInfo.playerPosition` -> `SessionInfo.playerSeat`
- `StateUpdate.playerPosition` -> `StateUpdate.playerSeat`

Note: Some parameter names like `playerPosition` in function signatures may be kept for backward compatibility with external callers, but internal usage will prefer `playerSeat`.
</naming_decision>

<tasks>

<task type="auto">
  <name>Task 1: Update session/types.ts error codes and types</name>
  <files>
    src/session/types.ts
  </files>
  <action>
Update error codes and type definitions:

1. **Error codes (lines 52-53)**:
   - `POSITION_ALREADY_CLAIMED = 'POSITION_ALREADY_CLAIMED'` -> `SEAT_ALREADY_CLAIMED = 'SEAT_ALREADY_CLAIMED'`
   - `INVALID_POSITION = 'INVALID_POSITION'` -> `INVALID_SEAT = 'INVALID_SEAT'`

2. **ExclusivePlayerOption JSDoc (lines 184-186)**:
   - Update "player position" references in comments to "player seat"
   - `default?: 'first' | 'last' | number` - update JSDoc: "Specific player position (1-indexed)" -> "Specific player seat (1-indexed)"

3. **PlayerGameState.players (line 393)**:
   - `{ name: string; position: number; ... }` -> `{ name: string; seat: number; ... }`

4. **LobbySlot interface (lines 428-429)**:
   - `position: number` -> `seat: number`
   - Update JSDoc: "Position index (0-based)" -> "Seat number (1-indexed)" (verify if 0-based or 1-based)

5. **SessionInfo (line 483)**:
   - `playerPosition: number` -> `playerSeat: number`

6. **StateUpdate (line 494)**:
   - `playerPosition: number` -> `playerSeat: number`

7. **WebSocketMessage (lines 569-571)**:
   - `position?: number` for claimPosition -> `seat?: number`
   - Update JSDoc comment

8. **ClaimPositionRequest (lines 592-594)**:
   - Rename interface to `ClaimSeatRequest`
   - `position: number` -> `seat: number`
  </action>
  <verify>
Run `npx tsc --noEmit` - will show errors in files that use these types (expected).
  </verify>
  <done>
Error codes renamed to SEAT_ALREADY_CLAIMED and INVALID_SEAT. LobbySlot.seat, SessionInfo.playerSeat, StateUpdate.playerSeat defined.
  </done>
</task>

<task type="auto">
  <name>Task 2: Update session implementation files</name>
  <files>
    src/session/utils.ts
    src/session/game-session.ts
    src/session/state-history.ts
    src/session/pending-action-manager.ts
    src/session/selection-handler.ts
  </files>
  <action>
Update all session implementation files:

**utils.ts:**
- Line 24: Function `isPlayersTurn(flowState, playerPosition)` - keep parameter name for now
- Line 349: `buildPlayerState(..., playerPosition, ...)` - keep parameter name
- Line 403: `{ name: player.name ?? \`Player ${player.position}\`, position: player.position }` -> `{ name: player.name ?? \`Player ${player.seat}\`, seat: player.seat }`
- Lines 420-444: Update all `playerPosition` -> `playerSeat` where it refers to the player's seat
- Update all `player.position` -> `player.seat` throughout

**game-session.ts:**
- All `playerPosition` parameters can stay (external API) but update JSDoc to clarify "player's seat number"
- Line 1230: `session.playerPosition` -> `session.playerSeat`
- Line 1237: `playerPosition: session.playerPosition` -> `playerSeat: session.playerSeat`
- Update all internal `player.position` -> `player.seat`

**state-history.ts:**
- Keep `playerPosition` parameters for API stability
- Update JSDoc comments: "Player's position" -> "Player's seat"
- Update error messages: "Invalid player position" -> "Invalid player seat"
- Lines 268-269: Update error message
- Update all `player.position` -> `player.seat`

**pending-action-manager.ts:**
- Keep `playerPosition` parameters
- Update error messages and comments
- Lines 93-94: Update error message about player positions being 1-indexed

**selection-handler.ts:**
- Keep `playerPosition` parameters
- Lines 56-57: Update error message
- Line 75: Update error message "Player not found at position" -> "Player not found at seat"
  </action>
  <verify>
Run `npx tsc --noEmit` - errors should decrease in src/session/.
  </verify>
  <done>
All session implementation files use `player.seat` internally. Error messages reference "seat" instead of "position".
  </done>
</task>

<task type="auto">
  <name>Task 3: Update client and server types</name>
  <files>
    src/client/types.ts
    src/server/types.ts
    src/server/core.ts
    src/server/handlers/games.ts
    src/server/handlers/matchmaking.ts
  </files>
  <action>
Update client SDK and server types:

**client/types.ts:**
- Lines 45-52: `MatchmakingResult.playerPosition` -> `playerSeat`
- Lines 74-75: `MatchmakingStatus.playerPosition` -> `playerSeat`
- Line 106: `PlayerState.players[].position` -> `PlayerState.players[].seat`
- Lines 108-109: Update JSDoc "Current player's position" -> "Current player's seat"
- Lines 128-129: `GameState.playerPosition` -> `GameState.playerSeat`
- Lines 153-154: `GameConnectionConfig.playerPosition` -> `GameConnectionConfig.playerSeat`
- Lines 305-306: `LobbySlot.position` -> `LobbySlot.seat`
- Lines 348-349: `ClaimPositionRequest.position` -> `ClaimSeatRequest.seat` (rename interface too)
- Line 359: `ClaimPositionResponse.position` -> `ClaimSeatResponse.seat`
- Lines 382-384: `RemoveSlotRequest.position` -> `RemoveSlotRequest.seat`
- Lines 388-390: `SetSlotAIRequest.position` -> `SetSlotAIRequest.seat`

**server/types.ts:**
- Line 156: `playerPosition` -> `playerSeat`
- Line 248: `playerPosition` -> `playerSeat`

**server/core.ts:**
- Keep `playerPosition` in query param parsing (`parseInt(query.player || '1', 10)`) for backward compat
- Lines 169-180: Keep parameter parsing as is (external API)
- Lines 293-294: Keep as is
- Line 499, 522, 529: `session.playerPosition` -> `session.playerSeat`
- Line 529: `playerPosition: session.playerPosition` -> `playerSeat: session.playerSeat`
- Line 777-794: Update function signature JSDoc, keep param name for API

**server/handlers/games.ts:**
- Keep `playerPosition` parameters for API stability
- Update internal usage where needed
- Update any error messages

**server/handlers/matchmaking.ts:**
- Lines 123, 140: `playerPosition` -> `playerSeat` in response objects
  </action>
  <verify>
Run `npx tsc --noEmit` - should show no errors in src/session/, src/client/, src/server/.
Run `npm test -- --run src/session` to verify session tests pass.
  </verify>
  <done>
Client types use `playerSeat`, `LobbySlot.seat`. Server handlers updated. All code compiles.
  </done>
</task>

</tasks>

<verification>
After all tasks complete:

1. `npx tsc --noEmit` - No errors in src/session/, src/client/, src/server/
2. `npm test -- --run src/session` - Session tests pass
3. Grep check: `grep -r "\.position" src/session/ src/client/ src/server/` - Should NOT find `player.position` or `LobbySlot.position`
4. Grep check: `grep -r "INVALID_POSITION\|POSITION_ALREADY" src/` - Should return NO results
</verification>

<success_criteria>
- Error codes renamed to INVALID_SEAT and SEAT_ALREADY_CLAIMED
- LobbySlot.seat replaces LobbySlot.position
- SessionInfo.playerSeat and StateUpdate.playerSeat defined
- PlayerGameState.players uses `seat` instead of `position`
- All session, client, and server code compiles
- Session tests pass
</success_criteria>

<output>
After completion, create `.planning/phases/56-position-seat-rename/56-02-SUMMARY.md`
</output>
