---
phase: 57-selection-pick-rename
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - src/engine/action/types.ts
  - src/session/types.ts
  - src/session/selection-handler.ts
  - src/session/pick-handler.ts
  - src/session/pending-action-manager.ts
  - src/session/game-session.ts
  - src/session/index.ts
autonomous: true

must_haves:
  truths:
    - "SelectionMetadata renamed to PickMetadata in session types"
    - "SelectionHandler renamed to PickHandler"
    - "SelectionTrace renamed to PickTrace in engine types"
    - "All exports updated to use pick terminology"
  artifacts:
    - path: "src/session/pick-handler.ts"
      provides: "Renamed handler class"
      contains: "class PickHandler"
    - path: "src/session/types.ts"
      provides: "Renamed session types"
      contains: "interface PickMetadata"
    - path: "src/engine/action/types.ts"
      provides: "Renamed engine types"
      contains: "interface PickTrace"
  key_links:
    - from: "src/session/index.ts"
      to: "src/session/pick-handler.ts"
      via: "export"
      pattern: "export.*PickHandler"
    - from: "src/session/types.ts"
      to: "SelectionMetadata"
      via: "deprecation alias"
      pattern: "SelectionMetadata = PickMetadata"
---

<objective>
Rename selection-related types and classes to use "pick" terminology in the engine and session layers.

Purpose: Align public API with nomenclature.md's definition of "Pick" as a choice a player must make.
Output: Renamed types (PickMetadata, PickFilter, PickChoicesResponse, PickTrace, PickDebugInfo, PickHandler) with deprecation aliases for backward compatibility.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/57-selection-pick-rename/57-RESEARCH.md

@src/engine/action/types.ts
@src/session/types.ts
@src/session/selection-handler.ts
@src/session/index.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Rename engine action types</name>
  <files>src/engine/action/types.ts, src/engine/index.ts</files>
  <action>
In src/engine/action/types.ts:
1. Rename `SelectionTrace` to `PickTrace`
2. Rename `SelectionDebugInfo` to `PickDebugInfo`
3. Add deprecation aliases at the end of the file:
   ```typescript
   /** @deprecated Use PickTrace instead */
   export type SelectionTrace = PickTrace;
   /** @deprecated Use PickDebugInfo instead */
   export type SelectionDebugInfo = PickDebugInfo;
   ```
4. Update any JSDoc comments that mention "selection" to say "pick" where referring to user choices

In src/engine/index.ts:
- Update re-exports if needed (should auto-resolve via type aliases)

Keep internal Selection type, SelectionType enum, ChoiceSelection, ElementSelection, etc. unchanged - these are implementation details per the research.
  </action>
  <verify>
- `grep -r "PickTrace" src/engine/` shows the new type
- `grep -r "SelectionTrace" src/engine/` shows only the deprecation alias
- `npm run typecheck` passes (types resolve correctly)
  </verify>
  <done>Engine types renamed with deprecation aliases for backward compatibility</done>
</task>

<task type="auto">
  <name>Task 2: Rename session types and handler</name>
  <files>src/session/types.ts, src/session/selection-handler.ts, src/session/pick-handler.ts, src/session/pending-action-manager.ts, src/session/game-session.ts, src/session/index.ts</files>
  <action>
In src/session/types.ts:
1. Rename `SelectionMetadata` to `PickMetadata`
2. Rename `SelectionFilter` to `PickFilter`
3. Rename `SelectionChoicesResponse` to `PickChoicesResponse`
4. Add deprecation aliases:
   ```typescript
   /** @deprecated Use PickMetadata instead */
   export type SelectionMetadata = PickMetadata;
   /** @deprecated Use PickFilter instead */
   export type SelectionFilter = PickFilter;
   /** @deprecated Use PickChoicesResponse instead */
   export type SelectionChoicesResponse = PickChoicesResponse;
   ```
5. Update the re-exports from engine (SelectionTrace -> PickTrace) with aliases
6. Update error code names if needed: INVALID_SELECTION and SELECTION_NOT_FOUND should become INVALID_PICK and PICK_NOT_FOUND (add deprecated aliases for old names)

Rename src/session/selection-handler.ts to src/session/pick-handler.ts:
1. Use `git mv src/session/selection-handler.ts src/session/pick-handler.ts`
2. Rename class `SelectionHandler` to `PickHandler`
3. Rename method `getSelectionChoices` to `getPickChoices`
4. Update JSDoc comments to reference "pick" instead of "selection"
5. Keep parameter names like `selectionName` for API stability (per Phase 56 precedent)

In src/session/pending-action-manager.ts:
1. Rename `SelectionStepResult` to `PickStepResult`
2. Add deprecation alias
3. Update method references and JSDoc

In src/session/game-session.ts:
1. Update import from pick-handler.ts
2. Update any references to SelectionHandler -> PickHandler
3. Update method calls from getSelectionChoices -> getPickChoices

In src/session/index.ts:
1. Update exports: PickHandler, PickMetadata, PickFilter, PickChoicesResponse, PickStepResult
2. Include deprecation aliases in exports for backward compatibility
  </action>
  <verify>
- `git mv` preserves file history
- `grep -r "PickHandler" src/session/` shows the new class
- `grep -r "PickMetadata" src/session/` shows the new type
- `npm run typecheck` passes
- `npm test src/session` passes (all session tests)
  </verify>
  <done>Session types and handler renamed with deprecation aliases, file history preserved</done>
</task>

<task type="auto">
  <name>Task 3: Verify and fix downstream consumers</name>
  <files>src/server/core.ts, src/server/handlers/games.ts, src/ai/mcts-bot.ts</files>
  <action>
Check and update any files that import/use the renamed types:

In src/server/core.ts and src/server/handlers/games.ts:
- Update imports to use PickHandler, getPickChoices
- Or verify they still work via deprecation aliases

In src/ai/mcts-bot.ts:
- Check for SelectionTrace/SelectionDebugInfo usage
- Update to PickTrace/PickDebugInfo or verify aliases work

Run full test suite to catch any missed references.
  </action>
  <verify>
- `npm run typecheck` passes
- `npm test` passes (full test suite)
- No TypeScript errors about missing Selection* types
  </verify>
  <done>All downstream consumers updated, full test suite passes</done>
</task>

</tasks>

<verification>
- `npm run typecheck` passes
- `npm test` passes (all tests)
- `grep -r "SelectionMetadata" src/` shows only deprecation aliases and internal types
- `grep -r "PickMetadata" src/session/types.ts` shows the new type
- `git log --oneline src/session/pick-handler.ts` shows history preserved
</verification>

<success_criteria>
- Engine types renamed: PickTrace, PickDebugInfo
- Session types renamed: PickMetadata, PickFilter, PickChoicesResponse, PickStepResult
- Handler renamed: PickHandler with getPickChoices method
- Deprecation aliases provided for backward compatibility
- All tests pass
- TypeScript compiles cleanly
</success_criteria>

<output>
After completion, create `.planning/phases/57-selection-pick-rename/57-01-SUMMARY.md`
</output>
