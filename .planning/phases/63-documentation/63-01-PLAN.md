---
phase: 63-documentation
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - docs/ui-components.md
  - docs/nomenclature.md
autonomous: true

must_haves:
  truths:
    - "Developer can find animation event documentation in docs/ui-components.md"
    - "Developer can understand soft continuation pattern from documentation"
    - "Developer can implement animation event handlers following documented examples"
    - "Developer can find animation event terminology in docs/nomenclature.md"
  artifacts:
    - path: "docs/ui-components.md"
      provides: "Animation Events section with examples"
      contains: "## Animation Events"
    - path: "docs/nomenclature.md"
      provides: "Animation event terminology"
      contains: "Animation Event"
  key_links:
    - from: "docs/ui-components.md"
      to: "docs/nomenclature.md"
      via: "terminology cross-reference"
      pattern: "nomenclature\\.md"
---

<objective>
Document the animation event system for game developers.

Purpose: Enable developers to implement animation events in their games by providing comprehensive documentation with practical examples and clear terminology definitions.

Output: Updated docs/ui-components.md with Animation Events section, updated docs/nomenclature.md with animation event terminology.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/63-documentation/63-RESEARCH.md

@docs/ui-components.md
@docs/nomenclature.md

# Implementation references
@src/engine/element/game.ts
@src/ui/composables/useAnimationEvents.ts
@src/ui/composables/useActionController.ts
@src/ui/composables/useAutoAnimations.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add Animation Events section to ui-components.md</name>
  <files>docs/ui-components.md</files>
  <action>
Add a comprehensive "Animation Events" section after the Theming section (before Action Controller API section, around line 1128). Structure the section as follows:

## Animation Events

### Overview
- Explain soft continuation pattern: game state advances immediately, UI plays back asynchronously
- Clarify that animation events are UI hints, NOT commands or state mutations
- Emphasize the parallel channel concept

### Engine-Side: Emitting Events
Document `game.emitAnimationEvent(type, data, options?)`:
- type: string identifying the event type
- data: arbitrary payload for the handler
- options: optional { group: string } for batching

Include example from RESEARCH.md showing combat damage emission:
```typescript
execute({ attacker, target }) {
  const damage = attacker.attack - target.defense;
  target.health -= damage;

  // Emit animation event - game state already changed!
  this.emitAnimationEvent('combat', {
    attackerId: attacker.id,
    targetId: target.id,
    damage,
    outcome: target.health <= 0 ? 'kill' : 'hit',
  });
}
```

Also show grouped events example for complex sequences.

### UI-Side: Consuming Events
Document the composable API:
- `createAnimationEvents({ events, acknowledge, defaultDuration? })` - Creates instance
- `provideAnimationEvents(animationEvents)` - Provides to component tree
- `useAnimationEvents()` - Injects animation events

Document the returned object:
- `registerHandler(type, handler)` - Register handler, returns cleanup function
- `isAnimating` - Ref<boolean> indicating playback in progress
- `paused` - Ref<boolean> for pause/resume control
- `skipAll()` - Skip remaining animations

Include example showing handler registration with async animation:
```typescript
const animations = useAnimationEvents();

animations?.registerHandler('combat', async (event) => {
  const { attackerId, targetId, damage, outcome } = event.data;
  await playAttackAnimation(attackerEl, targetEl);
  await showDamageNumber(targetEl, damage);
  if (outcome === 'kill') {
    await playDeathAnimation(targetEl);
  }
});
```

### Integration with useAutoAnimations
Document the `eventHandlers` option:
```typescript
const { flyingElements } = useAutoAnimations({
  gameView: () => props.gameView,
  containers: [...],
  eventHandlers: {
    combat: async (event) => await playCombatAnimation(event.data),
    score: async (event) => await playScoreAnimation(event.data),
  },
  animationEvents,
});
```

### ActionController Integration
Document:
- `animationsPending` computed property
- `showActionPanel` gates on: isMyTurn AND !animationsPending AND !pendingFollowUp
- Pass `animationEvents` to useActionController for automatic gating

### Common Pitfalls
Document the 5 pitfalls from RESEARCH.md:
1. Forgetting to acknowledge events (events accumulate, replay on every state update)
2. Mutating event data in handlers (shallow copy only)
3. Not handling handler errors (errors logged but don't stop chain)
4. Blocking UI on animations (only gate decision-making, not viewing)
5. Not understanding showActionPanel vs isMyTurn

Cross-reference: "See [Nomenclature](./nomenclature.md) for animation event terminology"
  </action>
  <verify>
- grep "## Animation Events" docs/ui-components.md returns match
- grep "emitAnimationEvent" docs/ui-components.md returns match
- grep "useAnimationEvents" docs/ui-components.md shows multiple occurrences
- grep "soft continuation" docs/ui-components.md returns match
- grep "animationsPending" docs/ui-components.md returns match
  </verify>
  <done>
docs/ui-components.md contains complete Animation Events section with:
- Overview explaining soft continuation pattern
- Engine-side API documentation with emitAnimationEvent examples
- UI-side composable documentation with handler registration examples
- useAutoAnimations eventHandlers integration
- ActionController integration (animationsPending, showActionPanel)
- Common pitfalls section
- Cross-reference to nomenclature.md
  </done>
</task>

<task type="auto">
  <name>Task 2: Add animation event terminology to nomenclature.md</name>
  <files>docs/nomenclature.md</files>
  <action>
Add three new terminology entries to docs/nomenclature.md. Add a new section "## Animation" after "## UI Components" section (before "## Related Documentation") with these entries:

### Animation Event

**Definition:** A UI hint emitted during game execution that flows to UI consumers for asynchronous playback. Animation events do NOT mutate game state - the game continues immediately while UI plays back events (soft continuation pattern).

**In Code:** `AnimationEvent` interface; `game.emitAnimationEvent()` method
**Related Terms:** Soft Continuation, Animation Handler, Animation Acknowledgment
**Usage:**
- "Emit an animation event when combat resolves"
- "The UI plays back animation events while state already advanced"

### Animation Handler

**Definition:** A function registered with the animation events system to play back a specific event type. Handlers receive the event and return a Promise that resolves when the animation completes.

**In Code:** `AnimationHandler` type; registered via `registerHandler()`
**Related Terms:** Animation Event, Animation Acknowledgment
**Usage:**
- "Register a handler for combat animation events"
- "The handler controls animation timing via its returned Promise"

### Soft Continuation

**Definition:** Design pattern where game state advances immediately and UI plays back asynchronously. The UI "catches up" to the current state through animation playback, rather than blocking state advancement.

**In Code:** Architecture pattern (not a specific type)
**Related Terms:** Animation Event, ActionPanel gating
**Usage:**
- "BoardSmith uses soft continuation - state doesn't wait for animations"
- "The ActionPanel gates on animation completion to prevent premature decisions"

Also update the Quick Reference table at the top to include:
| Animation Event | A UI hint for asynchronous animation playback |
| Animation Handler | A function that plays back a specific event type |
| Soft Continuation | Pattern where state advances immediately, UI plays back |
  </action>
  <verify>
- grep "## Animation" docs/nomenclature.md returns match
- grep "Animation Event" docs/nomenclature.md returns multiple matches (quick ref + definition)
- grep "Soft Continuation" docs/nomenclature.md returns match
- grep "Animation Handler" docs/nomenclature.md returns match
  </verify>
  <done>
docs/nomenclature.md contains:
- New "Animation" section with three terminology entries
- Animation Event definition with code references and usage examples
- Animation Handler definition with code references and usage examples
- Soft Continuation definition explaining the design pattern
- Quick Reference table updated with all three terms
  </done>
</task>

</tasks>

<verification>
1. Documentation completeness:
   - docs/ui-components.md has Animation Events section after Theming, before Action Controller API
   - docs/nomenclature.md has Animation section with 3 entries

2. Content verification:
   - Engine API documented (emitAnimationEvent with examples)
   - UI composables documented (createAnimationEvents, useAnimationEvents)
   - Integration patterns documented (useAutoAnimations, ActionController)
   - Pitfalls documented for common mistakes
   - Terminology cross-referenced between docs

3. Requirements traceability:
   - DOC-01: Animation event system in ui-components.md - verified
   - DOC-02: Animation events in nomenclature.md - verified
</verification>

<success_criteria>
1. docs/ui-components.md contains Animation Events section with:
   - Soft continuation pattern explanation
   - Engine-side emitAnimationEvent documentation with code examples
   - UI-side composable API (createAnimationEvents, useAnimationEvents, registerHandler)
   - useAutoAnimations eventHandlers integration
   - ActionController integration (animationsPending, showActionPanel)
   - Common pitfalls section
   - Cross-reference to nomenclature.md

2. docs/nomenclature.md contains:
   - Quick Reference table entries for Animation Event, Animation Handler, Soft Continuation
   - Full definitions for all three terms in new Animation section
   - Code references and usage examples for each term
</success_criteria>

<output>
After completion, create `.planning/phases/63-documentation/63-01-SUMMARY.md`
</output>
