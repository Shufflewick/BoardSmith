---
phase: 70-type-consolidation
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - src/session/types.ts
  - src/client/types.ts
  - src/ui/components/WaitingRoom.vue
autonomous: true

must_haves:
  truths:
    - "LobbyState, SlotStatus, LobbySlot, LobbyInfo are defined only in types/protocol.ts"
    - "session/types.ts re-exports lobby types from types/protocol.ts"
    - "client/types.ts re-exports lobby types from types/protocol.ts"
    - "WaitingRoom.vue imports lobby types from canonical source"
    - "All imports across codebase resolve correctly"
    - "All tests pass"
  artifacts:
    - path: "src/types/protocol.ts"
      provides: "Canonical lobby type definitions"
      contains: "export type LobbyState"
    - path: "src/session/types.ts"
      provides: "Re-exports from protocol.ts"
      contains: "from '../types/protocol.js'"
    - path: "src/client/types.ts"
      provides: "Re-exports from protocol.ts"
      contains: "from '../types/protocol.js'"
    - path: "src/ui/components/WaitingRoom.vue"
      provides: "Imports from protocol.ts"
      contains: "from '../../types/protocol.js'"
  key_links:
    - from: "src/session/types.ts"
      to: "src/types/protocol.ts"
      via: "re-export"
      pattern: "export type.*from.*types/protocol"
    - from: "src/client/types.ts"
      to: "src/types/protocol.ts"
      via: "re-export"
      pattern: "export type.*from.*types/protocol"
---

<objective>
Consolidate duplicated lobby types (LobbyState, SlotStatus, LobbySlot, LobbyInfo) to single canonical source in types/protocol.ts.

Purpose: Eliminate type drift risk from having identical types defined in 4 locations. The client/types.ts copy is already missing 3 properties (gameOptionsDefinitions, colorSelectionEnabled, colors).

Output: All lobby type imports resolve to types/protocol.ts as the single source of truth.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/70-type-consolidation/70-RESEARCH.md

# Key files
@src/types/protocol.ts (canonical source - lines 17-85)
@src/session/types.ts (duplicate at lines 432-494)
@src/client/types.ts (duplicate at lines 297-345)
@src/ui/components/WaitingRoom.vue (inline definitions at lines 14-67)
</context>

<tasks>

<task type="auto">
  <name>Task 1: Update session/types.ts to re-export from canonical source</name>
  <files>src/session/types.ts</files>
  <action>
    1. Locate the "Lobby Types" section (around line 428-494)
    2. Remove the duplicate type definitions:
       - `LobbyState` type alias (line ~435)
       - `SlotStatus` type alias (line ~440)
       - `LobbySlot` interface (lines ~445-462)
       - `LobbyInfo` interface (lines ~467-494)
    3. Add re-export statement at the start of the Lobby Types section:
       ```typescript
       // Re-export lobby types from canonical source
       export type {
         LobbyState,
         SlotStatus,
         LobbySlot,
         LobbyInfo,
       } from '../types/protocol.js';
       ```
    4. Keep the section header comment for organization
    5. Keep any non-lobby types in this section (like ClaimSeatRequest, LobbyUpdate, etc.)
  </action>
  <verify>
    - `npm run build` succeeds with no TypeScript errors
    - `grep -n "export type LobbyState" src/session/types.ts` shows NO local definition
    - `grep -n "from.*protocol" src/session/types.ts` shows the re-export
  </verify>
  <done>session/types.ts re-exports LobbyState, SlotStatus, LobbySlot, LobbyInfo from types/protocol.ts with no local definitions</done>
</task>

<task type="auto">
  <name>Task 2: Update client/types.ts to re-export from canonical source</name>
  <files>src/client/types.ts</files>
  <action>
    1. Locate the "Lobby Types" section (around line 293-345)
    2. Remove the duplicate type definitions:
       - `LobbyState` type alias (line ~298)
       - `SlotStatus` type alias (line ~301)
       - `LobbySlot` interface (lines ~304-321)
       - `LobbyInfo` interface (lines ~324-345)
    3. Add re-export statement at the start of the Lobby Types section:
       ```typescript
       // Re-export lobby types from canonical source
       export type {
         LobbyState,
         SlotStatus,
         LobbySlot,
         LobbyInfo,
       } from '../types/protocol.js';
       ```
    4. Keep the section header comment for organization
    5. Keep any lobby-related request/response types that are specific to client (ClaimSeatRequest, ClaimSeatResponse, LobbyResponse, SetReadyRequest, etc.)

    IMPORTANT: The canonical LobbyInfo has additional properties (gameOptionsDefinitions, colorSelectionEnabled, colors) that were missing from client/types.ts. This is intentional - the canonical source is complete.
  </action>
  <verify>
    - `npm run build` succeeds with no TypeScript errors
    - `grep -n "export type LobbyState" src/client/types.ts` shows NO local definition
    - `grep -n "from.*protocol" src/client/types.ts` shows the re-export
  </verify>
  <done>client/types.ts re-exports LobbyState, SlotStatus, LobbySlot, LobbyInfo from types/protocol.ts with no local definitions</done>
</task>

<task type="auto">
  <name>Task 3: Update WaitingRoom.vue to import from canonical source</name>
  <files>src/ui/components/WaitingRoom.vue</files>
  <action>
    1. Locate the inline type definitions at the top of the script (lines 14-67)
    2. Remove all inline lobby type definitions:
       - `LobbySlot` interface (lines 14-23)
       - `NumberGameOption` interface (lines 26-34)
       - `SelectGameOption` interface (lines 36-42)
       - `BooleanGameOption` interface (lines 44-50)
       - `GameOptionDefinition` type alias (line 51)
       - `LobbyInfo` interface (lines 53-67)
       - `StandardPlayerOption` interface (lines 70-76)
       - `ExclusivePlayerOption` interface (lines 78-84)
       - `PlayerOptionDefinition` type alias (line 85)
    3. Add import statement after the Vue imports (after line 12):
       ```typescript
       import type {
         LobbySlot,
         LobbyInfo,
         GameOptionDefinition,
       } from '../../types/protocol.js';
       import type {
         PlayerOptionDefinition,
       } from '../../session/types.js';
       ```
    4. Note: LobbyState and SlotStatus are not directly used in WaitingRoom.vue props/local vars, only via LobbySlot and LobbyInfo, so they don't need explicit import.
  </action>
  <verify>
    - `npm run build` succeeds with no TypeScript errors
    - `grep -n "interface LobbySlot" src/ui/components/WaitingRoom.vue` shows NO results (inline definition removed)
    - `grep -n "from.*protocol" src/ui/components/WaitingRoom.vue` shows the import
  </verify>
  <done>WaitingRoom.vue imports LobbySlot, LobbyInfo, GameOptionDefinition from types/protocol.ts and PlayerOptionDefinition from session/types.ts with no inline definitions</done>
</task>

</tasks>

<verification>
After all tasks complete:

1. **Type location check:**
   ```bash
   # Should find ONLY in types/protocol.ts
   grep -rn "export type LobbyState" src/ --include="*.ts"
   grep -rn "export type SlotStatus" src/ --include="*.ts"
   grep -rn "export interface LobbySlot" src/ --include="*.ts"
   grep -rn "export interface LobbyInfo" src/ --include="*.ts"
   ```

2. **Re-export check:**
   ```bash
   # Should show re-exports in session/types.ts and client/types.ts
   grep -n "from.*types/protocol" src/session/types.ts src/client/types.ts
   ```

3. **Build verification:**
   ```bash
   npm run build
   ```

4. **Test verification:**
   ```bash
   npm test
   ```
</verification>

<success_criteria>
- LobbyState, SlotStatus, LobbySlot, LobbyInfo are defined ONLY in types/protocol.ts
- session/types.ts re-exports all 4 lobby types from types/protocol.ts
- client/types.ts re-exports all 4 lobby types from types/protocol.ts
- WaitingRoom.vue imports from canonical source (no inline definitions)
- `npm run build` succeeds
- `npm test` passes (all 504+ tests)
</success_criteria>

<output>
After completion, create `.planning/phases/70-type-consolidation/70-01-SUMMARY.md`
</output>
