---
phase: 77-ui-integration
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - src/ui/composables/useActionControllerTypes.ts
  - src/ui/composables/useBoardInteraction.ts
autonomous: true

must_haves:
  truths:
    - "UI-layer ValidElement carries disabled?: string on both controller and board interaction types"
    - "UI-layer ChoiceWithRefs carries disabled?: string"
    - "PickSnapshot.choices array entries carry disabled?: string"
    - "isDisabledElement() returns the reason string for disabled elements and false for enabled"
    - "Clicking a disabled element on the board does nothing (triggerElementSelect ignores it)"
  artifacts:
    - path: "src/ui/composables/useActionControllerTypes.ts"
      provides: "disabled?: string on ValidElement, ChoiceWithRefs, PickSnapshot.choices"
      contains: "disabled?: string"
    - path: "src/ui/composables/useBoardInteraction.ts"
      provides: "isDisabledElement method, disabled on ValidElement, triggerElementSelect guard"
      contains: "isDisabledElement"
  key_links:
    - from: "src/ui/composables/useActionControllerTypes.ts"
      to: "src/ui/composables/useBoardInteraction.ts"
      via: "Both define ValidElement with disabled field (separate interfaces)"
      pattern: "disabled\\?: string"
---

<objective>
Add disabled?: string to all UI-layer type interfaces and add disabled-aware methods to board interaction.

Purpose: This is the type foundation for the entire UI Integration phase. All rendering and logic changes depend on these types carrying the disabled field from the wire layer through to UI consumers.

Output: Updated type interfaces and board interaction composable with isDisabledElement() method and triggerElementSelect guard.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/77-ui-integration/77-RESEARCH.md
@.planning/phases/76-session-wire/76-01-SUMMARY.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add disabled?: string to UI-layer types</name>
  <files>src/ui/composables/useActionControllerTypes.ts, src/ui/composables/useBoardInteraction.ts</files>
  <action>
**useActionControllerTypes.ts:**

1. Add `disabled?: string` to the `ChoiceWithRefs` interface (after `targetRef`):
```typescript
/** Disabled reason string, present only when choice is disabled */
disabled?: string;
```

2. Add `disabled?: string` to the `ValidElement` interface (after `element`):
```typescript
/** Disabled reason string, present only when element is disabled */
disabled?: string;
```

3. Add `disabled?: string` to the `PickSnapshot.choices` array type. The current type is:
```typescript
choices?: Array<{ value: unknown; display: string; sourceRef?: ElementRef; targetRef?: ElementRef }>;
```
Add `disabled?: string` to the inline object type:
```typescript
choices?: Array<{ value: unknown; display: string; sourceRef?: ElementRef; targetRef?: ElementRef; disabled?: string }>;
```

4. Similarly add `disabled?: string` to `PickChoicesResult.choices` array type. The current type is:
```typescript
choices?: Array<{ value: unknown; display: string; sourceRef?: unknown; targetRef?: unknown }>;
```
Add `disabled?: string`:
```typescript
choices?: Array<{ value: unknown; display: string; sourceRef?: unknown; targetRef?: unknown; disabled?: string }>;
```

**useBoardInteraction.ts:**

5. Add `disabled?: string` to the board interaction's `ValidElement` interface (line 39-42):
```typescript
export interface ValidElement {
  id: number;
  ref: ElementRef;
  disabled?: string;
}
```

6. Add `isDisabledElement` to the `BoardInteractionActions` interface:
```typescript
/** Check if a board element is disabled for the current action selection. Returns reason string or false. */
isDisabledElement: (element: { id?: number; name?: string; notation?: string }) => string | false;
```

7. Implement `isDisabledElement` in `createBoardInteraction()` actions object:
```typescript
isDisabledElement(element) {
  const validElem = state.validElements.find(ve => matchesRef(element, ve.ref));
  if (!validElem) return false;
  return validElem.disabled || false;
},
```

8. Guard `triggerElementSelect` to ignore disabled elements. Change:
```typescript
if (validElem && state.onElementSelect) {
```
to:
```typescript
if (validElem && !validElem.disabled && state.onElementSelect) {
```

The `disabled` field on wire types (`src/session/types.ts`, `src/types/protocol.ts`) was added in Phase 76. The JSON data already flows through to PickSnapshot storage transparently. Adding the field to UI types makes TypeScript aware of it so the rendering and logic code can read it without casting.
  </action>
  <verify>
Run `npx tsc --noEmit` to confirm no type errors.
Run `npx vitest run` to confirm no test regressions.
  </verify>
  <done>
- `ChoiceWithRefs`, `ValidElement` (controller), `PickSnapshot.choices`, and `PickChoicesResult.choices` all have `disabled?: string`
- Board interaction `ValidElement` has `disabled?: string`
- `isDisabledElement()` method exists on `BoardInteractionActions`
- `triggerElementSelect` skips disabled elements
- All existing tests pass
  </done>
</task>

</tasks>

<verification>
- `npx tsc --noEmit` passes (no type errors)
- `npx vitest run` passes (no regressions)
- Grep confirms `disabled?: string` appears in both ValidElement definitions
- Grep confirms `isDisabledElement` appears in interface and implementation
</verification>

<success_criteria>
UI-layer types carry disabled field. Board interaction exposes isDisabledElement() and guards triggerElementSelect against disabled elements. Requirements UI-03 (partially - type surface), UI-04 (triggerElementSelect guard) addressed.
</success_criteria>

<output>
After completion, create `.planning/phases/77-ui-integration/77-01-SUMMARY.md`
</output>
