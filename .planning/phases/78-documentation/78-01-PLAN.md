---
phase: 78-documentation
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - BREAKING.md
  - docs/custom-ui-guide.md
  - docs/common-pitfalls.md
autonomous: true

must_haves:
  truths:
    - "BREAKING.md has a v2.8 section documenting the getChoices() return type change from T[] to AnnotatedChoice<T>[]"
    - "BREAKING.md v2.8 section includes before/after code examples showing the migration path"
    - "BREAKING.md v2.8 section documents the new disabled option on builder methods"
    - "Existing docs (custom-ui-guide.md, common-pitfalls.md) reflect the updated getChoices() return type including disabled?: string"
  artifacts:
    - path: "BREAKING.md"
      provides: "v2.8 breaking changes section"
      contains: "## v2.8"
    - path: "docs/custom-ui-guide.md"
      provides: "Updated getChoices() documentation with disabled field"
      contains: "disabled"
    - path: "docs/common-pitfalls.md"
      provides: "Updated getChoices() return shape description"
      contains: "disabled"
  key_links:
    - from: "BREAKING.md"
      to: "docs/custom-ui-guide.md"
      via: "cross-reference link"
      pattern: "custom-ui-guide"
---

<objective>
Document the v2.8 breaking changes and update existing docs to reflect the disabled selections feature.

Purpose: External teams can migrate to v2.8 without surprises by reading the breaking changes and migration guide. Existing documentation stays accurate so developers following the custom UI guide don't encounter outdated type information.

Output: BREAKING.md v2.8 section with before/after code examples, updated custom-ui-guide.md and common-pitfalls.md reflecting the new getChoices() return type.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md

@BREAKING.md
@docs/custom-ui-guide.md
@docs/common-pitfalls.md
@docs/plans/2026-02-05-disabled-selections-design.md
@src/engine/action/types.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add v2.8 section to BREAKING.md</name>
  <files>BREAKING.md</files>
  <action>
Add a new `## v2.8` section at the TOP of BREAKING.md (above the existing v2.7 section). Follow the exact style and structure of the v2.7 section already in the file.

The v2.8 section must document THREE changes:

**1. getChoices() return type change (BREAKING)**

This is the primary breaking change. The engine-level `getChoices()` (on ActionExecutor) previously returned `T[]` and now returns `AnnotatedChoice<T>[]` where each item has `{ value: T, disabled: string | false }`.

Additionally, `game.getSelectionChoices()` (the public Game method) changed from `unknown[]` to `AnnotatedChoice<unknown>[]`.

Show a clear before/after:

Before:
```typescript
const choices = game.getSelectionChoices('attack', 'target', player);
// choices: unknown[] -- values directly
for (const choice of choices) {
  console.log(choice); // the value itself
}
```

After:
```typescript
import { AnnotatedChoice } from 'boardsmith/engine';

const choices = game.getSelectionChoices('attack', 'target', player);
// choices: AnnotatedChoice<unknown>[] -- annotated with disabled status
for (const choice of choices) {
  console.log(choice.value);     // the actual value
  console.log(choice.disabled);  // string reason or false
}
```

Migration table:
| Before | After |
|--------|-------|
| `choices[i]` | `choices[i].value` |
| `choices.includes(x)` | `choices.some(c => c.value === x)` |
| `choices.map(c => ...)` | `choices.map(c => { /* use c.value */ })` |

**2. UI getChoices()/getCurrentChoices() return type change (ADDITIVE)**

The `actionController.getChoices()` and `actionController.getCurrentChoices()` return type changed from `Array<{ value: unknown; display: string }>` to `Array<{ value: unknown; display: string; disabled?: string }>`. This is additive (existing code still works), but callers should be aware of the new field.

**3. New disabled option on builder methods (ADDITIVE)**

Document that `chooseElement()`, `fromElements()`, and `chooseFrom()` now accept a `disabled` callback option with signature `(item, context) => string | false`. This is additive -- no existing code breaks.

Show an example:
```typescript
action('equip')
  .fromElements('equipment', {
    elements: (ctx) => ctx.game.all(Equipment),
    disabled: (equip, ctx) =>
      equip.isExplosive ? "Cannot use explosives" : false,
  })
```

Include a brief note about the filter vs disabled separation: `filter` controls visibility (what's in the pool), `disabled` controls selectability (what can be selected within the pool).

End the section with a cross-reference: "See the [Custom UI Guide](docs/custom-ui-guide.md) for updated `getChoices()` usage examples."
  </action>
  <verify>Read BREAKING.md and confirm: (1) v2.8 section exists above v2.7, (2) has before/after code for getChoices return type, (3) has migration table, (4) documents disabled builder option, (5) follows same formatting style as v2.7 section.</verify>
  <done>BREAKING.md has a v2.8 section with complete before/after code examples for the getChoices() return type change, UI getChoices disabled field addition, disabled builder option documentation, and cross-reference to custom UI guide.</done>
</task>

<task type="auto">
  <name>Task 2: Update existing docs for disabled field on getChoices()</name>
  <files>docs/custom-ui-guide.md, docs/common-pitfalls.md</files>
  <action>
Update two docs files where getChoices() return type is described to include the new `disabled?: string` field.

**docs/custom-ui-guide.md** -- Section "Understanding getChoices() Return Values" (around line 320):

1. Update the return type description from:
   ```typescript
   Array<{ value: unknown; display: string }>
   ```
   to:
   ```typescript
   Array<{ value: unknown; display: string; disabled?: string }>
   ```

2. Add a brief paragraph after the existing content explaining the `disabled` field:
   - `disabled` is present only on items that are disabled (absent on selectable items)
   - Contains the reason string explaining why the item cannot be selected
   - Custom UIs can use this to render disabled state however they want (grey out, tooltip, etc.)

3. Add a short code example showing how to handle disabled choices in a custom UI:
   ```typescript
   const choices = actionController.getChoices(currentPick);

   // Render with disabled state
   for (const choice of choices) {
     if (choice.disabled) {
       // Show greyed out with reason tooltip
       renderDisabled(choice.display, choice.disabled);
     } else {
       renderSelectable(choice.display, choice.value);
     }
   }
   ```

4. Similarly, in the validElements section (Step 4), add a note that `validElements` items now carry `disabled?: string` and custom UIs should check it:
   ```typescript
   const selectableCards = computed(() => {
     const { currentPick, validElements } = props.actionController;
     if (currentPick.value?.type !== 'element') return [];

     return validElements.value.map(ve => ({
       id: ve.id,
       display: ve.display,
       disabled: ve.disabled, // reason string or undefined
     }));
   });
   ```

**docs/common-pitfalls.md** -- Section about getChoices() return values (around line 1386):

Update the line:
```
`getChoices()` returns `{ value, display }` objects for UI rendering:
```
to:
```
`getChoices()` returns `{ value, display, disabled? }` objects for UI rendering:
```

And add `disabled` to the bullet list:
- `disabled`: Optional reason string if this choice is disabled (absent if selectable)
  </action>
  <verify>Read docs/custom-ui-guide.md around line 320 and confirm the return type includes `disabled?: string`. Read docs/common-pitfalls.md around line 1386 and confirm it mentions the disabled field.</verify>
  <done>Both docs files accurately reflect the updated getChoices() return type with the disabled?: string field, including usage examples for custom UIs.</done>
</task>

</tasks>

<verification>
1. `grep -n "## v2.8" BREAKING.md` shows the new section exists
2. `grep -n "AnnotatedChoice" BREAKING.md` shows the type is documented with before/after examples
3. `grep -n "disabled" docs/custom-ui-guide.md` shows disabled field documented in getChoices section
4. `grep -n "disabled" docs/common-pitfalls.md` shows disabled field in the return type description
5. The v2.8 section in BREAKING.md follows the same formatting patterns as v2.7 (headers, code blocks, migration tables)
</verification>

<success_criteria>
- BREAKING.md v2.8 section documents getChoices() return type change with before/after code examples
- BREAKING.md v2.8 section documents disabled builder option with example
- docs/custom-ui-guide.md reflects updated getChoices() return type including disabled?: string
- docs/common-pitfalls.md reflects updated getChoices() return shape
- All documentation is accurate relative to the actual code in src/engine/action/types.ts and src/ui/composables/useActionControllerTypes.ts
</success_criteria>

<output>
After completion, create `.planning/phases/78-documentation/78-01-SUMMARY.md`
</output>
