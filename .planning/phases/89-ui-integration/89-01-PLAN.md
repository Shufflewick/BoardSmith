---
phase: 89-ui-integration
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - src/ui/composables/useAnimationEvents.ts
  - src/ui/composables/useAnimationEvents.test.ts
  - src/ui/components/GameShell.vue
autonomous: true

must_haves:
  truths:
    - "createAnimationEvents() accepts no acknowledge parameter -- the interface has only events, defaultDuration, and handlerWaitTimeout"
    - "processQueue and skipAll never call acknowledge -- no reference to acknowledge exists in the function body"
    - "GameShell.vue passes only events to createAnimationEvents -- no acknowledge callback"
    - "useCurrentView composable and CURRENT_VIEW_KEY do not exist anywhere in src/"
    - "GameShell provides a single gameView with no currentGameView alternative"
    - "ActionPanel gates on animationsPending before showing decisions"
  artifacts:
    - path: "src/ui/composables/useAnimationEvents.ts"
      provides: "Animation event composable without acknowledge"
      contains: "UseAnimationEventsOptions"
    - path: "src/ui/composables/useAnimationEvents.test.ts"
      provides: "Tests for animation events without acknowledge"
    - path: "src/ui/components/GameShell.vue"
      provides: "Root component wiring animation events without acknowledge"
  key_links:
    - from: "src/ui/components/GameShell.vue"
      to: "src/ui/composables/useAnimationEvents.ts"
      via: "createAnimationEvents({ events: ... })"
      pattern: "createAnimationEvents\\(\\{\\s*events:"
    - from: "src/ui/composables/useActionController.ts"
      to: "src/ui/composables/useAnimationEvents.ts"
      via: "animationEvents.isAnimating"
      pattern: "animationEvents\\?.isAnimating"
---

<objective>
Remove the dead acknowledgment callback from the animation events composable and verify the full UI integration chain.

Purpose: The acknowledge callback was the bridge between client-side animation playback and server-side acknowledgment tracking. The server-side system was removed in Phase 85. Since then, acknowledge has been wired to a no-op `() => {}`. This plan removes the dead parameter from the interface, implementation, tests, and call sites -- completing requirement CLI-10. It also verifies CLI-11 (useCurrentView already deleted), UI-01 (ActionPanel gating already working), UI-02 (GameShell wiring), and UI-03 (single gameView).

Output: Clean `useAnimationEvents.ts` with no acknowledge references, updated tests, updated GameShell.vue
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/89-ui-integration/89-RESEARCH.md
@src/ui/composables/useAnimationEvents.ts
@src/ui/composables/useAnimationEvents.test.ts
@src/ui/components/GameShell.vue
</context>

<tasks>

<task type="auto">
  <name>Task 1: Remove acknowledge from implementation and GameShell</name>
  <files>
    src/ui/composables/useAnimationEvents.ts
    src/ui/components/GameShell.vue
  </files>
  <action>
  In `src/ui/composables/useAnimationEvents.ts`:

  1. Remove the docstring example line referencing acknowledge (line 21: `acknowledge: (upToId) => notifyServer(upToId),`)
  2. Remove the `acknowledge` field from `UseAnimationEventsOptions` interface (line 51-52: the JSDoc comment and the `acknowledge: (upToId: number) => void;` field)
  3. Remove `acknowledge` from the destructuring in `createAnimationEvents()` (line 109: change to `const { events: getEvents, defaultDuration = 0, handlerWaitTimeout = 3000 } = options;`)
  4. Remove `acknowledge(event.id);` call in processQueue timeout-skip path (line 214)
  5. Remove `acknowledge(event.id);` call in processQueue after-handler path (line 231)
  6. Remove the comment `// If we have queued events, acknowledge them all` in skipAll (line 243)
  7. Remove `acknowledge(lastEvent.id);` call in skipAll (line 246)

  In `src/ui/components/GameShell.vue`:

  1. Update the comment on line 167 from "Animation events - wire createAnimationEvents to WebSocket acknowledge" to "Animation events - wire createAnimationEvents to server state"
  2. Remove the `acknowledge: () => {},` line (line 170) from the createAnimationEvents call

  Do NOT remove `defaultDuration` or `handlerWaitTimeout` from the interface -- those serve active purposes.
  Do NOT touch `useActionController.ts` or `ActionPanel.vue` -- they do not reference acknowledge.
  </action>
  <verify>
  Run `npx tsc --noEmit` -- it will fail on the test file (expected, Task 2 fixes tests), but verify no OTHER TypeScript errors exist beyond the test file. The source files themselves must be clean.

  Grep for "acknowledge" in `src/ui/composables/useAnimationEvents.ts` -- should return zero results.
  Grep for "acknowledge" in `src/ui/components/GameShell.vue` -- should return zero results.
  </verify>
  <done>
  `useAnimationEvents.ts` has zero references to "acknowledge". `UseAnimationEventsOptions` interface has exactly three fields: `events`, `defaultDuration`, `handlerWaitTimeout`. GameShell.vue passes only `{ events: ... }` to createAnimationEvents.
  </done>
</task>

<task type="auto">
  <name>Task 2: Update tests -- remove acknowledge from all call sites and delete acknowledge-only tests</name>
  <files>
    src/ui/composables/useAnimationEvents.test.ts
  </files>
  <action>
  In `src/ui/composables/useAnimationEvents.test.ts`:

  **Systematic removal of acknowledge from all createAnimationEvents call sites (~40 occurrences):**

  For every test that creates an `acknowledge` vi.fn() and passes it to `createAnimationEvents({ ... acknowledge ... })`:
  1. Remove the `const acknowledge = vi.fn();` line
  2. Remove the `acknowledge,` property from the createAnimationEvents options object

  **Delete the entire `describe('acknowledgment', ...)` block (lines 714-844):**
  This block contains 6 test cases that ONLY test acknowledge behavior:
  - "calls acknowledge after each event (per-event advancement)"
  - "passes correct event ID per call (non-sequential IDs)"
  - "skipAll acknowledges remaining events with single call to last ID"
  - "does not acknowledge if no events processed"
  - "acknowledge is called between handler completions (not batched)"

  The last test ("acknowledge is called between handler completions") also validates sequential handler processing order, BUT this behavior is already covered by the "waits for handler Promise before next event" test in the "sequential processing" describe block (lines 157-184). So it is safe to delete the entire acknowledgment describe block.

  **Update tests that assert acknowledge call counts as side-assertions:**
  - In "events without handlers are skipped when handlerWaitTimeout is 0" (line 219-246): Remove `expect(acknowledge).toHaveBeenCalledWith(3);` (line 245). The test's primary assertion about `handled` array is the correct one to keep.
  - In "acknowledges all pending event IDs" (line 342-369): DELETE this entire test case -- its sole purpose is testing acknowledge in skipAll. The "clears pending events" test (line 310-340) already covers skipAll behavior.
  - In "works when paused (resumes and clears)" (line 400-439): Remove `expect(acknowledge).toHaveBeenCalledWith(3);` (line 438). Keep the rest of the test.
  - In "timeout expires and event is skipped with console warning" (line 881-908): Remove `expect(acknowledge).toHaveBeenCalledWith(42);` (line 905). Keep the console.warn and isAnimating assertions.
  - In "handlerWaitTimeout: 0 skips immediately (backward compat)" (line 1040-1060): Remove `expect(acknowledge).toHaveBeenCalledWith(1);` (line 1057). Keep the console.warn assertion.

  **Pitfall to avoid:** Do NOT delete tests whose primary purpose is testing handler execution order, event deduplication, or queue behavior. Only remove acknowledge-specific assertions and tests whose SOLE purpose is verifying acknowledge calls.
  </action>
  <verify>
  Run `npx tsc --noEmit` -- zero TypeScript errors.
  Run `npx vitest run src/ui/composables/useAnimationEvents.test.ts` -- all tests pass.
  Grep for "acknowledge" in `src/ui/composables/useAnimationEvents.test.ts` -- should return zero results.
  </verify>
  <done>
  All tests pass. Zero references to "acknowledge" in the test file. The acknowledgment describe block is deleted. All other tests preserved with acknowledge-specific assertions removed.
  </done>
</task>

</tasks>

<verification>
After both tasks complete:

1. **TypeScript compilation:** `npx tsc --noEmit` passes with zero errors
2. **Tests pass:** `npx vitest run src/ui/composables/useAnimationEvents.test.ts` -- all pass
3. **Full test suite:** `npx vitest run` -- no regressions in any module
4. **No acknowledge references in UI module:** `grep -r "acknowledge" src/ui/` returns zero results
5. **No useCurrentView references:** `grep -r "useCurrentView\|CURRENT_VIEW_KEY" src/` returns zero results
6. **No currentGameView references:** `grep -r "currentGameView" src/ui/` returns zero results
7. **ActionPanel gating intact:** `grep "animationsPending" src/ui/components/auto-ui/ActionPanel.vue` returns matches confirming gating is present
8. **Single gameView provided:** `grep "provide.*gameView" src/ui/components/GameShell.vue` returns exactly one match
</verification>

<success_criteria>
- CLI-10 satisfied: `createAnimationEvents()` no longer accepts or uses an acknowledgment callback
- CLI-11 verified: `useCurrentView()` composable and `CURRENT_VIEW_KEY` do not exist in src/
- UI-01 verified: ActionPanel gates on `animationsPending` before showing new decisions
- UI-02 satisfied: GameShell wires `createAnimationEvents` without acknowledge callback
- UI-03 verified: GameShell provides single `gameView` (truth) with no `currentGameView` alternative
- All tests pass, no TypeScript errors, no regressions
</success_criteria>

<output>
After completion, create `.planning/phases/89-ui-integration/89-01-SUMMARY.md`
</output>
