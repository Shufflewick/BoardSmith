---
phase: 90-documentation-migration
plan: 02
type: execute
wave: 1
depends_on: []
files_modified:
  - ~/BoardSmithGames/demo-animation/src/rules/actions.ts
  - ~/BoardSmithGames/demo-animation/src/ui/components/GameTable.vue
  - ~/BoardSmithGames/cribbage/src/rules/game.ts
  - ~/BoardSmithGames/cribbage/src/ui/components/CribbageBoard.vue
autonomous: false

must_haves:
  truths:
    - "demo-animation game runs correctly in browser with the new animation system"
    - "cribbage game animations work correctly in browser with the new system"
    - "No TypeScript errors from removed API usage (acknowledge parameter)"
  artifacts:
    - path: "~/BoardSmithGames/demo-animation/src/rules/actions.ts"
      provides: "Clean game.animate() calls without empty callbacks"
    - path: "~/BoardSmithGames/cribbage/src/ui/components/CribbageBoard.vue"
      provides: "createAnimationEvents() without acknowledge parameter"
    - path: "~/BoardSmithGames/cribbage/src/rules/game.ts"
      provides: "Clean game.animate() calls -- empty callbacks removed, truth-advancing callbacks kept"
  key_links:
    - from: "~/BoardSmithGames/cribbage/src/ui/components/CribbageBoard.vue"
      to: "boardsmith/ui createAnimationEvents"
      via: "import and options object"
      pattern: "createAnimationEvents"
    - from: "~/BoardSmithGames/cribbage/src/rules/game.ts"
      to: "game.animate"
      via: "animation event emission"
      pattern: "game\\.animate\\("
---

<objective>
Migrate the demo-animation and cribbage example games to the v3.0 animation system.

Purpose: These example games still reference removed v2.9 APIs. The cribbage game passes an `acknowledge` parameter to `createAnimationEvents()` which no longer exists -- this is a compile error. Both games have empty `() => {}` callbacks in `game.animate()` calls that should be removed for clarity. After migration, both games must run correctly in the browser.

Output: Both example games compile and run with the v3.0 animation system, verified in browser.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/90-documentation-migration/90-RESEARCH.md

# v3.0 API (source of truth)
@src/ui/composables/useAnimationEvents.ts

# Files to migrate
@~/BoardSmithGames/demo-animation/src/rules/actions.ts
@~/BoardSmithGames/demo-animation/src/ui/components/GameTable.vue
@~/BoardSmithGames/cribbage/src/rules/game.ts
@~/BoardSmithGames/cribbage/src/ui/components/CribbageBoard.vue
</context>

<tasks>

<task type="auto">
  <name>Task 1: Migrate demo-animation game</name>
  <files>
    ~/BoardSmithGames/demo-animation/src/rules/actions.ts
    ~/BoardSmithGames/demo-animation/src/ui/components/GameTable.vue
  </files>
  <action>
  Migrate the demo-animation example game to v3.0.

  **actions.ts:**
  1. Line ~337: Change `game.animate('demo', data, () => {})` to `game.animate('demo', data)` -- remove the empty callback. The callback did nothing; pure data form is the v3.0 pattern.
  2. Lines ~307-315: Update any comments that reference "mutation capture", "theatre view", or "captures state mutations". Replace with language describing pure data events. For example: "Emits animation event for UI playback" instead of "Captures state mutations for theatre view advancement".
  3. Scan the entire file for any other references to removed concepts and update them.

  **GameTable.vue:**
  1. Line ~68: Update the comment that says "Inject animation events from GameShell (which creates and provides it with server acknowledge)" to remove the "server acknowledge" part. New comment: "Inject animation events from GameShell" or similar.
  2. Scan for any other outdated comments referencing theatre, acknowledge, or mutation capture.

  After changes, verify the game compiles:
  ```bash
  cd ~/BoardSmithGames/demo-animation && npx tsc --noEmit
  ```
  </action>
  <verify>
  - `grep -r "() => {}" ~/BoardSmithGames/demo-animation/src/rules/actions.ts` returns NO matches for game.animate calls
  - `grep -ri "theatre\|mutation capture\|acknowledge" ~/BoardSmithGames/demo-animation/src/rules/actions.ts ~/BoardSmithGames/demo-animation/src/ui/components/GameTable.vue` returns NO matches
  - TypeScript compilation succeeds: `cd ~/BoardSmithGames/demo-animation && npx tsc --noEmit`
  </verify>
  <done>demo-animation game has clean v3.0 animate calls (no empty callbacks), no outdated comments, and compiles without errors.</done>
</task>

<task type="auto">
  <name>Task 2: Migrate cribbage game</name>
  <files>
    ~/BoardSmithGames/cribbage/src/rules/game.ts
    ~/BoardSmithGames/cribbage/src/ui/components/CribbageBoard.vue
  </files>
  <action>
  Migrate the cribbage example game to v3.0. This game has a BREAKING change (acknowledge parameter) and cleanup items.

  **CribbageBoard.vue (BREAKING FIX):**
  1. Lines ~283-289: Remove the `acknowledge` parameter from the `createAnimationEvents()` call. The `acknowledge` property no longer exists on `UseAnimationEventsOptions`. Change from:
     ```typescript
     const animationEventsController = createAnimationEvents({
       events: () => props.gameView?.attributes?.animationEvents as AnimationEvent[] | undefined,
       acknowledge: (upToId: number) => {
         console.log('[Cribbage AnimationEvents] Acknowledged up to ID:', upToId);
       },
     });
     ```
     To:
     ```typescript
     const animationEventsController = createAnimationEvents({
       events: () => props.gameView?.attributes?.animationEvents as AnimationEvent[] | undefined,
     });
     ```
  2. Remove the console.log for acknowledgment -- it no longer serves a purpose.
  3. Scan for any other references to `acknowledge`, `theatre`, or `currentView` in the file and clean them up.

  **game.ts (CLEANUP):**
  1. Line ~595: Update comment about "theatre view state advancement" to describe pure data event emission.
  2. Lines with `game.animate('score-hand-start', data, () => {})`: Remove the empty callbacks. Change to `game.animate('score-hand-start', data)`. These are pure signal events.
  3. Lines with `game.animate('score-item', data, () => {})`: Remove the empty callbacks. Change to `game.animate('score-item', data)`.
  4. **KEEP** callbacks on `game.animate('score-hand-complete', data, () => { this.addPoints(...) })` -- these advance truth and are valid in v3.0.
  5. Scan the file for other outdated comments referencing theatre view, mutation capture, or acknowledgment.

  CRITICAL: Use `this.animate(...)` or `game.animate(...)` -- match whichever pattern the cribbage game already uses. Read the file first to confirm.

  After changes, verify the game compiles:
  ```bash
  cd ~/BoardSmithGames/cribbage && npx tsc --noEmit
  ```
  </action>
  <verify>
  - `grep "acknowledge" ~/BoardSmithGames/cribbage/src/ui/components/CribbageBoard.vue` returns NO matches
  - `grep -ri "theatre\|mutation capture" ~/BoardSmithGames/cribbage/src/rules/game.ts ~/BoardSmithGames/cribbage/src/ui/components/CribbageBoard.vue` returns NO matches
  - `grep "score-hand-complete" ~/BoardSmithGames/cribbage/src/rules/game.ts` still returns matches (truth-advancing callbacks kept)
  - `grep "() => {}" ~/BoardSmithGames/cribbage/src/rules/game.ts` returns NO matches for game.animate calls with empty callbacks
  - TypeScript compilation succeeds: `cd ~/BoardSmithGames/cribbage && npx tsc --noEmit`
  </verify>
  <done>Cribbage game has the acknowledge parameter removed from createAnimationEvents(), empty callbacks removed from signal-only animate() calls, truth-advancing callbacks preserved, outdated comments cleaned up, and compiles without errors.</done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <what-built>Migrated both demo-animation and cribbage example games to v3.0 animation system. Removed empty callbacks, removed acknowledge parameter, updated comments. Both games compile.</what-built>
  <how-to-verify>
  1. Start the demo-animation game:
     ```bash
     cd ~/BoardSmithGames/demo-animation && npx boardsmith dev
     ```
  2. Open the game in browser and trigger animations. Verify:
     - Animation events fire and display correctly
     - No console errors related to animation system
     - Game plays through normally

  3. Start the cribbage game:
     ```bash
     cd ~/BoardSmithGames/cribbage && npx boardsmith dev
     ```
  4. Open the game in browser and play through a round. Verify:
     - Score animations play correctly (score-hand-start, score-item, score-hand-complete)
     - Points are awarded correctly after score-hand-complete animations
     - No console errors related to animation system or acknowledge
     - Game plays through a full round without issues

  5. Check the browser console in both games for any warnings about missing handlers or animation timeouts.
  </how-to-verify>
  <resume-signal>Type "approved" if both games work correctly, or describe any issues seen.</resume-signal>
</task>

</tasks>

<verification>
After all tasks complete and browser verification passes:
1. Both example games compile without TypeScript errors
2. demo-animation game runs with animations in browser
3. cribbage game runs with score animations in browser
4. No references to removed v2.9 APIs in either game
5. Truth-advancing callbacks in cribbage are preserved
</verification>

<success_criteria>
- demo-animation game: clean v3.0 animate calls, no outdated comments, runs correctly in browser
- cribbage game: acknowledge parameter removed, empty callbacks removed, truth-advancing callbacks kept, runs correctly in browser with score animations
- Both games have zero references to theatre view, mutation capture, or acknowledgment protocol
</success_criteria>

<output>
After completion, create `.planning/phases/90-documentation-migration/90-02-SUMMARY.md`
</output>
